(function(){"use strict";var e={6450:function(e,t,a){var s=a(5130),r=a(6768);const o={id:"app"},i={class:"main-content"};function n(e,t,a,s,n,l){const c=(0,r.g2)("NotificationComponent"),d=(0,r.g2)("MainHeader"),u=(0,r.g2)("router-view"),p=(0,r.g2)("MainFooter");return(0,r.uX)(),(0,r.CE)(r.FK,null,[t[0]||(t[0]=(0,r.Lk)("div",{class:"marquee"},[(0,r.Lk)("span",null,"2024.09.01，注意！本公司不會主動通知帳務問題，若有相關疑問請洽客服！小心詐騙！")],-1)),(0,r.Lk)("div",o,[(0,r.bF)(c),(0,r.bF)(d),(0,r.Lk)("div",i,[(0,r.bF)(u)]),(0,r.bF)(p)])],64)}var l=a(4232);const c={class:"header-container"},d={class:"headerbar d-flex align-items-center"},u={key:0,class:"nav-toggle-wrapper d-flex align-items-center ms-2"},p=["src"],m={class:"nav-content d-flex w-100 align-items-center justify-content-between"},g=["to"],h={class:"search-container d-flex mx-lg-3"},k={class:"search-input-wrapper"},b={class:"cartmember d-flex"},f=["src"],v={key:0,class:"member-item"},L={class:"cart-text"},y=["src"];function w(e,t,a,o,i,n){const w=(0,r.g2)("BNavbarToggle"),C=(0,r.g2)("router-link"),I=(0,r.g2)("BNavbarNav"),_=(0,r.g2)("BFormInput"),P=(0,r.g2)("BButton"),A=(0,r.g2)("BCollapse"),E=(0,r.g2)("BContainer"),F=(0,r.g2)("BNavbar");return(0,r.uX)(),(0,r.CE)("div",c,[(0,r.bF)(F,{toggleable:"lg",type:"light",variant:"light",class:"navbar-overlay px-0"},{default:(0,r.k6)((()=>[(0,r.bF)(E,{fluid:""},{default:(0,r.k6)((()=>[(0,r.Lk)("div",d,[(0,r.bF)(w,{onClick:n.toggleNav},null,8,["onClick"]),i.isNavOpen?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",u,[(0,r.Lk)("img",{src:e.$getImageUrl("arrowleft.png"),alt:"導航提示",class:"nav-toggle-image",onClick:t[0]||(t[0]=(...e)=>n.toggleNav&&n.toggleNav(...e))},null,8,p),t[4]||(t[4]=(0,r.Lk)("span",{class:"nav-toggle-text ms-1"},"請點選此處開啟導航欄",-1))]))]),(0,r.bF)(A,{id:"nav-collapse",modelValue:i.isNavOpen,"onUpdate:modelValue":t[3]||(t[3]=e=>i.isNavOpen=e),"is-nav":""},{default:(0,r.k6)((()=>[(0,r.Lk)("div",m,[(0,r.bF)(I,{class:"nav-links me-lg-3"},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.navItems,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.path,to:e.path,class:"nav-item-container"},[(0,r.bF)(C,{to:e.path,class:"nav-link-text",onClick:n.closeNav},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.text),1)])),_:2},1032,["to","onClick"])],8,g)))),128))])),_:1}),(0,r.Lk)("div",h,[(0,r.Lk)("div",k,[(0,r.bF)(_,{type:"text",modelValue:i.searchQuery,"onUpdate:modelValue":t[1]||(t[1]=e=>i.searchQuery=e),class:"search-box",placeholder:"請輸入想找的商品搜尋",onKeyup:(0,s.jR)(n.handleSearch,["enter"])},null,8,["modelValue","onKeyup"]),(0,r.bF)(P,{class:"search-button btn btn-primary ms-2",onClick:n.handleSearch},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.eW)("搜尋")]))),_:1},8,["onClick"])])]),(0,r.Lk)("div",b,[(0,r.bF)(C,{class:"cart-item me-3",to:"/ShopCart",onClick:n.closeNav},{default:(0,r.k6)((()=>[(0,r.Lk)("img",{src:e.$getImageUrl("shopping_cart.png"),alt:"",class:"icon-img"},null,8,f),t[6]||(t[6]=(0,r.Lk)("span",{class:"cart-text"},"購物車",-1))])),_:1},8,["onClick"]),n.isLoggedIn?((0,r.uX)(),(0,r.CE)("div",v,[(0,r.Lk)("span",L,"歡迎 "+(0,l.v_)(n.userName),1),(0,r.Lk)("button",{class:"btn btn-link cart-text",onClick:t[2]||(t[2]=(...e)=>n.logout&&n.logout(...e))},"會員登出")])):((0,r.uX)(),(0,r.Wv)(C,{key:1,class:"member-item",to:"/UserLogin",onClick:n.closeNav},{default:(0,r.k6)((()=>[(0,r.Lk)("img",{src:e.$getImageUrl("member_login.png"),alt:"",class:"icon-img"},null,8,y),t[7]||(t[7]=(0,r.Lk)("span",{class:"cart-text"},"會員登入",-1))])),_:1},8,["onClick"]))])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])}a(4114);var C={name:"MainHeader",data(){return{searchQuery:"",isNavOpen:window.innerWidth<992,navItems:[{path:"/",text:"首頁"},{path:"/MembersPage",text:"會員中心"},{path:"/ProductsList",text:"產品列表"},{path:"/AboutUsPage",text:"關於我們"},{path:"/ContactUs",text:"聯絡我們"},{path:"/admin",text:"後台"}]}},computed:{isLoggedIn(){return this.$store.state.auth.isLoggedIn},userName(){return this.$store.state.auth.user?this.$store.state.auth.user.name:""}},methods:{handleSearch(){""!==this.searchQuery.trim()&&(this.$router.push({path:"/ProductsList",query:{search:this.searchQuery.trim()}}),this.closeNav())},toggleNav(){this.isNavOpen=!this.isNavOpen},closeNav(){window.innerWidth<992&&(this.isNavOpen=!1)},checkScreenSize(){window.innerWidth>=992?this.isNavOpen=!0:this.isNavOpen=!1},handleResize(){this.checkScreenSize()},logout(){this.$store.dispatch("auth/logout"),this.$router.push({path:"/"})}},mounted(){this.checkScreenSize(),window.addEventListener("resize",this.handleResize)},beforeUnmount(){window.removeEventListener("resize",this.handleResize)},watch:{$route(){this.closeNav()}}},I=a(1241);const _=(0,I.A)(C,[["render",w],["__scopeId","data-v-646a7b71"]]);var P=_;const A={class:"footer d-flex flex-column"};function E(e,t,a,s,o,i){return(0,r.uX)(),(0,r.CE)("div",A,t[0]||(t[0]=[(0,r.Lk)("div",{class:"flex-grow-1"},[(0,r.Lk)("p",null,[(0,r.eW)("台灣ECshop.com有限公司"),(0,r.Lk)("br"),(0,r.eW)(" 統編 99999999"),(0,r.Lk)("br"),(0,r.eW)(" Copyright 2024, ECSHOP Group.")])],-1)]))}var F={name:"MainFooter"};const S=(0,I.A)(F,[["render",E],["__scopeId","data-v-499e5536"]]);var O=S;const x={class:"notifications-container"},T=["onClick"],U={class:"message"},D=["onClick"];function N(e,t,a,o,i,n){return(0,r.uX)(),(0,r.CE)("div",x,[(0,r.bF)(s.F,{name:"notification"},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.notifications,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:(0,l.C4)(["notification",`notification-${e.type}`]),onClick:t=>o.closeNotification(e.id)},[(0,r.Lk)("span",U,(0,l.v_)(e.message),1),(0,r.Lk)("button",{class:"close-btn",onClick:(0,s.D$)((t=>o.closeNotification(e.id)),["stop"])},"×",8,D)],10,T)))),128))])),_:1})])}var R=a(782),$={name:"NotificationComponent",setup(){const e=(0,R.Pj)(),t=(0,r.EW)((()=>e.state.notifications.notifications)),a=t=>{e.dispatch("notifications/removeNotification",t)};return{notifications:t,closeNotification:a}}};const M=(0,I.A)($,[["render",N],["__scopeId","data-v-c8dde580"]]);var X=M,q={name:"App",components:{MainHeader:P,MainFooter:O,NotificationComponent:X},setup(){const e=(0,R.Pj)(),t=(0,r.EW)((()=>e.getters["auth/isLoggedIn"]));return{isLoggedIn:t}}};const W=(0,I.A)(q,[["render",n],["__scopeId","data-v-2873ea48"]]);var B=W,V=a(4233),K=(a(4188),a(323),a(3664)),j=a(8047),Q=(a(8992),a(7550),a(1387));a(9882);function J(e,t,a,s,o,i){return t[0]||(t[0]=(0,r.Fv)('<h1 style="color:coral;" data-v-b5050256>關於我們</h1><br data-v-b5050256><br data-v-b5050256><div data-v-b5050256><div class="title" data-v-b5050256>公司願景</div><div class="content" data-v-b5050256> ECSHOP 電商平台致力於打造一個以消費者需求為核心的全球購物平台，通過先進的技術、優質的產品及卓越的服務，提供每一位顧客最便捷、愉快的購物體驗。 我們相信，透過創新和精確的市場洞察，能為消費者和合作夥伴創造更多的價值，並推動電商產業的進步。 我們的願景是成為全球消費者心目中的首選購物平台，無論是日常所需還是高端商品，ECSHOP 都能夠滿足不同客戶的需求，並且實現跨境無縫銷售的全球電商體驗。 </div><div class="title" data-v-b5050256>未來展望</div><div class="content" data-v-b5050256> ECSHOP 將持續不斷地創造優質的產品和優秀的服務，並持續推動消費者需求的解決方案，讓消費者能更輕鬆地在全球購物。 我們也將不斷地學習和進步，以提供給消&quot;&gt;未來，ECSHOP 將持續拓展產品品類，並加強與世界各地的品牌商及供應商的合作，為消費者提供更豐富的選擇。同時，我們將致力於智能化技術的應用，利用大數據分析、人工智慧和物聯網等前沿技術，提升用戶體驗，優化物流配送效率，並實現個性化推薦和精準行銷。 我們也將積極推動環保和可持續發展，通過綠色物流、減少包裝浪費等措施，承擔企業社會責任，為地球的未來做出貢獻。 展望未來，ECSHOP 將不斷創新，推動整個行業的數位化轉型，並且努力實現「消費者、合作夥伴與企業共贏」的目標。我們期待與您攜手，共創電商新時代的輝煌！</div></div>',4))}var z={name:"AboutUsPage"};const H=(0,I.A)(z,[["render",J],["__scopeId","data-v-b5050256"]]);var G=H;const Z={class:"cart-container container mt-5"},Y={key:0,class:"text-center"},ee={class:"table table-hover"},te=["src"],ae=["onUpdate:modelValue","onInput"],se=["onClick"],re={class:"d-flex justify-content-between align-items-center mt-4"},oe=["disabled"];function ie(e,t,a,o,i,n){const c=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",Z,[t[5]||(t[5]=(0,r.Lk)("h2",{class:"text-center mb-4"},"我的購物車",-1)),0===o.cartItems.length?((0,r.uX)(),(0,r.CE)("div",Y,[t[3]||(t[3]=(0,r.Lk)("p",null,"購物車是空的。",-1)),(0,r.bF)(c,{to:"/",class:"btn btn-primary"},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)("去購物")]))),_:1})])):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Lk)("table",ee,[t[4]||(t[4]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",{scope:"col"},"商品圖片"),(0,r.Lk)("th",{scope:"col"},"商品名稱"),(0,r.Lk)("th",{scope:"col"},"單價"),(0,r.Lk)("th",{scope:"col"},"數量"),(0,r.Lk)("th",{scope:"col"},"小計"),(0,r.Lk)("th",{scope:"col"},"操作")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.cartItems,((e,a)=>((0,r.uX)(),(0,r.CE)("tr",{key:`${e.id}-${a}`},[(0,r.Lk)("td",null,[(0,r.Lk)("img",{src:e.image,alt:"item.name",class:"product-image",onError:t[0]||(t[0]=(...e)=>o.imageError&&o.imageError(...e))},null,40,te)]),(0,r.Lk)("td",null,(0,l.v_)(e.name),1),(0,r.Lk)("td",null,(0,l.v_)(e.price)+"元",1),(0,r.Lk)("td",null,[(0,r.bo)((0,r.Lk)("input",{type:"number",class:"form-control quantity-input","onUpdate:modelValue":t=>e.quantity=t,onInput:t=>o.updateQuantity(a,e.quantity),min:"1"},null,40,ae),[[s.Jo,e.quantity,void 0,{number:!0}]])]),(0,r.Lk)("td",null,(0,l.v_)(e.quantity*e.price)+"元",1),(0,r.Lk)("td",null,[(0,r.Lk)("button",{class:"btn btn-danger",onClick:e=>o.removeItem(a)},"刪除",8,se)])])))),128))])]),(0,r.Lk)("div",re,[(0,r.Lk)("h4",null,"總計："+(0,l.v_)(o.cartTotal)+"元",1),(0,r.Lk)("button",{class:"btn btn-success",disabled:0===o.cartItems.length,onClick:t[1]||(t[1]=(...e)=>o.checkout&&o.checkout(...e))},"結帳",8,oe)])],64))])}a(1454);var ne=a(4300),le={name:"ShopCart",setup(){const e=(0,R.Pj)(),t=(0,Q.rd)(),a=(0,r.EW)((()=>e.state.cart.items)),s=(0,r.EW)((()=>e.getters["cart/cartTotal"])),o=(0,r.EW)((()=>e.state.auth&&e.state.auth.isLoggedIn)),i=(t,a)=>{(!Number.isInteger(a)||a<1)&&(a=1),e.dispatch("cart/updateItemQuantity",{index:t,quantity:a})},n=e=>{e.target.src="/img/wrong.png"},l=t=>{e.dispatch("cart/removeItemFromCart",t)},c=async()=>{if(!o.value)return e.dispatch("notifications/showNotification",{type:"warning",message:"請先登入！",timeout:2e3}),void t.push({name:"UserLogin",query:{redirect:"/cart"}});const r=localStorage.getItem("authToken");if(!r)return e.dispatch("notifications/showNotification",{type:"error",message:"登入狀態已過期，請重新登入！",timeout:2e3}),void t.push({name:"UserLogin",query:{redirect:"/cart"}});if(0===a.value.length)return void e.dispatch("notifications/showNotification",{type:"warning",message:"購物車是空的，無法結帳！",timeout:2e3});const i={user_id:e.state.auth.user.id,items:a.value.map((e=>({product_id:e.id,quantity:e.quantity,price:e.price}))),total:s.value};try{const a=await ne.A.orderAPI.createOrder(i);if(a.orderId){if(e.dispatch("cart/clearShoppingCart"),e.dispatch("notifications/showNotification",{type:"success",message:"order已成功提交！",timeout:2e3}),window.WebSocket&&window.dashboardSocket)try{window.dashboardSocket.send(JSON.stringify({type:"newOrder",orderId:a.orderId,total:s.value,created_at:(new Date).toISOString()}))}catch(n){console.error("WebSocket發送消息失敗:",n)}t.push({name:"OrderConfirmation",params:{orderId:a.orderId}})}}catch(n){console.error("提交訂單失敗:",n),n.response&&403===n.response.status?(e.dispatch("notifications/showNotification",{type:"error",message:"權限不足或登入已過期，請重新登入！",timeout:2e3}),t.push({name:"UserLogin",query:{redirect:"/cart"}})):e.dispatch("notifications/showNotification",{type:"error",message:"提交訂單失敗，請稍後再試！",timeout:2e3})}};return{cartItems:a,cartTotal:s,updateQuantity:i,removeItem:l,checkout:c,imageError:n}}};const ce=(0,I.A)(le,[["render",ie],["__scopeId","data-v-2671b740"]]);var de=ce;const ue={class:"container mt-5"},pe={key:0},me={class:"row"},ge={class:"tag-filter mb-4"},he=["onClick"],ke={class:"search-bar mb-4"},be={class:"col-md-3"},fe=["max"],ve={class:"container mt-5"},Le={class:"row"};function ye(e,t,a,o,i,n){const c=(0,r.g2)("ProductCard");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Lk)("div",ue,[t[6]||(t[6]=(0,r.Lk)("h2",{class:"mb-4"},"商品列表",-1)),0===o.filteredProducts.length?((0,r.uX)(),(0,r.CE)("div",pe,t[2]||(t[2]=[(0,r.Lk)("p",null,"暫無符合條件的商品，請修改查詢條件！",-1)]))):(0,r.Q3)("",!0),(0,r.Lk)("div",me,[(0,r.Lk)("div",ge,[t[3]||(t[3]=(0,r.Lk)("h4",null,"選擇標籤",-1)),(0,r.Lk)("div",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.availableTags,(e=>((0,r.uX)(),(0,r.CE)("button",{key:e,onClick:t=>o.toggleTag(e),class:(0,l.C4)([{btn:!0,"btn-primary":o.selectedTags.includes(e),"btn-outline-primary":!o.selectedTags.includes(e)},"me-2 mb-2"])},(0,l.v_)(e),11,he)))),128))])]),(0,r.Lk)("div",ke,[(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>o.searchQuery=e),class:"form-control",placeholder:"搜尋產品..."},null,512),[[s.Jo,o.searchQuery]])]),(0,r.Lk)("div",be,[t[5]||(t[5]=(0,r.Lk)("h4",null,"篩選條件",-1)),(0,r.Lk)("div",null,[t[4]||(t[4]=(0,r.Lk)("label",null,"價格區間",-1)),(0,r.bo)((0,r.Lk)("input",{type:"range","onUpdate:modelValue":t[1]||(t[1]=e=>o.priceRange=e),min:"0",max:o.maxPrice,step:"500"},null,8,fe),[[s.Jo,o.priceRange]]),(0,r.Lk)("p",null,"價格："+(0,l.v_)(o.priceRange)+"元",1)])])])]),(0,r.Lk)("div",ve,[(0,r.Lk)("div",Le,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.filteredProducts,(e=>((0,r.uX)(),(0,r.CE)("div",{class:"col-md-3 mb-4",key:e.id},[(0,r.bF)(c,{product:e,onAddToCart:o.addToCart},null,8,["product","onAddToCart"])])))),128))])])],64)}a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698),a(4520),a(3949);var we=a(144);const Ce={class:"product-card"},Ie=["src"],_e={class:"card-title"},Pe={class:"card-text"},Ae=["disabled"];function Ee(e,t,a,s,o,i){const n=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",Ce,[(0,r.bF)(n,{to:{name:"ProductDetail",params:{id:s.productId}}},{default:(0,r.k6)((()=>[(0,r.Lk)("img",{src:s.productImageUrl,class:"product-image",alt:"Product Image",onError:t[0]||(t[0]=(...e)=>s.imageError&&s.imageError(...e))},null,40,Ie),(0,r.Lk)("h5",_e,(0,l.v_)(a.product.name),1),(0,r.Lk)("p",Pe,(0,l.v_)(s.formattedPrice)+" 元",1)])),_:1},8,["to"]),(0,r.Lk)("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=(...e)=>s.handleAddToCart&&s.handleAddToCart(...e)),disabled:s.isAdding},(0,l.v_)(s.isAdding?"添加中...":"加入購物車"),9,Ae)])}var Fe={name:"ProductCard",props:{product:{type:Object,required:!0,validator:function(e){const t=["id","name","price","image"],a=t.every((t=>t in e));return!!a&&("string"===typeof e.id||"number"===typeof e.id&&"string"===typeof e.name&&""!==e.name.trim()&&"number"===typeof e.price&&e.price>=0&&"string"===typeof e.image&&""!==e.image.trim())}}},setup(e,{emit:t}){const a=(0,we.KR)(!1),s=(0,r.EW)((()=>String(e.product.id).trim())),o=(0,r.EW)((()=>e.product.image?e.product.image:"/img/wrong.png")),i=(0,r.EW)((()=>{const t=parseFloat(e.product.price);return isNaN(t)?"0 元":new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)})),n=()=>{a.value||(a.value=!0,t("add-to-cart",e.product),setTimeout((()=>{a.value=!1}),1e3))},l=e=>{e.target.src="/img/wrong.png"};return{isAdding:a,productId:s,productImageUrl:o,formattedPrice:i,handleAddToCart:n,imageError:l}}};const Se=(0,I.A)(Fe,[["render",Ee],["__scopeId","data-v-2f34f966"]]);var Oe=Se,xe={name:"ProductsList",components:{ProductCard:Oe},setup(){const e=(0,we.KR)([]),t=(0,we.KR)(!1),a=(0,we.KR)(null),s=(0,r.EW)((()=>{if(!Array.isArray(e.value))return 1e6;const t=e.value.map((e=>Number(e.price)));return t.length?Math.max(...t):1e6})),o=(0,we.KR)(s.value),i=(0,we.KR)([]),n=(0,we.KR)([]),l=(0,R.Pj)(),c=(0,Q.rd)(),d=(0,Q.lq)(),u=(0,r.EW)((()=>l.state.auth.isLoggedIn)),p=(0,we.KR)(""),m=(0,r.EW)((()=>Array.isArray(e.value)?e.value.filter((e=>{const t=Number(e.price),a=e.name.toLowerCase().includes(p.value.toLowerCase()),s=t<=o.value,r=e.tags||[],i=0===n.value.length||n.value.some((e=>r.includes(e)));return a&&s&&i})):[])),g=async()=>{t.value=!0,a.value=null;try{const t=await ne.A.productAPI.getAllProducts();Array.isArray(t)?e.value=t.map((e=>({...e,id:String(e.id).trim(),price:Number(e.price),tags:Array.isArray(e.tags)?e.tags:[],image:e.image?`https://ecshop-backend.onrender.com/api/img/products/${e.image.split("/").pop()}`:"/img/default-product.jpg"}))):e.value=[],console.log("加載後的商品列表:",e.value),o.value=s.value;const a=new Set;e.value.forEach((e=>{e.tags&&Array.isArray(e.tags)&&e.tags.forEach((e=>a.add(e)))})),i.value=Array.from(a)}catch(r){console.error("加載商品時出錯",r),a.value="加載產品時出錯，請稍後再試！"}finally{t.value=!1}},h=e=>{n.value.includes(e)?n.value=n.value.filter((t=>t!==e)):n.value.push(e)},k=e=>{if(u.value)l.dispatch("cart/addProductToCart",e),l.dispatch("notifications/showNotification",{type:"success",message:`已將 ${e.name} 加入購物車`,timeout:2e3});else{l.dispatch("notifications/showNotification",{type:"warning",message:"請先登入會員再加入購物車！",timeout:2e3});const e=d.fullPath;c.push({name:"UserLogin",query:{redirect:e}})}};return(0,r.sV)((()=>{p.value=d.query.search||"",g().then((()=>{console.log("加載後的商品列表:",e.value)}))})),(0,r.wB)((()=>d.query.search),(e=>{p.value=e||""})),{products:e,maxPrice:s,priceRange:o,loading:t,error:a,isLoggedIn:u,filteredProducts:m,availableTags:i,selectedTags:n,searchQuery:p,toggleTag:h,addToCart:k}}};const Te=(0,I.A)(xe,[["render",ye],["__scopeId","data-v-d8000cb2"]]);var Ue=Te;const De={class:"container mt-5"},Ne={key:0,class:"product-detail"},Re={class:"row"},$e={class:"col-md-6"},Me={class:"image-container"},Xe=["src"],qe={class:"col-md-6"},We={class:"product-name"},Be={class:"product-description"},Ve={class:"product-price"},Ke={class:"d-flex mt-4"},je={key:1,class:"loading"};function Qe(e,t,a,s,o,i){return(0,r.uX)(),(0,r.CE)("div",De,[s.product&&s.product.id?((0,r.uX)(),(0,r.CE)("div",Ne,[(0,r.Lk)("div",Re,[(0,r.Lk)("div",$e,[(0,r.Lk)("div",Me,[(0,r.Lk)("img",{src:s.productImageUrl,alt:"Product Image",class:"product-image"},null,8,Xe)])]),(0,r.Lk)("div",qe,[(0,r.Lk)("h2",We,(0,l.v_)(s.product.name),1),(0,r.Lk)("p",Be,(0,l.v_)(s.product.description),1),(0,r.Lk)("h4",Ve,"價格："+(0,l.v_)(s.product.price)+" 元",1),(0,r.Lk)("div",Ke,[(0,r.Lk)("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...e)=>s.addToCart&&s.addToCart(...e))},"加入購物車"),(0,r.Lk)("button",{class:"btn btn-secondary ms-2",onClick:t[1]||(t[1]=(...e)=>s.goBack&&s.goBack(...e))},"返回上一頁")])])])])):((0,r.uX)(),(0,r.CE)("div",je,t[2]||(t[2]=[(0,r.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,r.Lk)("span",{class:"visually-hidden"},"正在加載...")],-1),(0,r.Lk)("p",null,"正在加載商品中...",-1)])))])}var Je={name:"ProductDetail",setup(){const e=(0,R.Pj)(),t=(0,Q.lq)(),a=(0,Q.rd)(),s=(0,we.KR)(null),o=(0,r.EW)((()=>t.params.id)),i=(0,r.EW)((()=>s.value&&s.value.image?s.value.image:"/img/wrong.png")),n=(0,r.EW)((()=>e.state.auth.isLoggedIn)),l=async()=>{if(!d(o.value))return notificationTypes("error","商品格式不正確，無法加載商品詳情"),void a.go(-1);try{s.value=await ne.A.productAPI.getProductById(o.value)}catch(e){console.error("加載商品詳情時出錯",e),notifiy("error","加載商品詳情失敗，請稍後再試！")}},c=()=>{n.value?(e.dispatch("cart/addProductToCart",s.value),u("success",`已將${s.value.name}加入購物車`)):p()},d=e=>/^[1-9]\d*$/.test(e),u=(t,a)=>{e.dispatch("notifications/showNotification",{type:t,message:a})},p=()=>{a.push({name:"UserLogin",query:{redirect:t.fullPath}})},m=()=>a.go(-1);return(0,r.sV)(l),{addToCart:c,goBack:m,product:s,productId:o,productImageUrl:i}}};const ze=(0,I.A)(Je,[["render",Qe],["__scopeId","data-v-0935ec02"]]);var He=ze;const Ge={class:"member-page bg-light"},Ze={class:"container py-4"},Ye={class:"member-profile mb-4"},et={class:"profile-header d-flex align-items-center"},tt={class:"avatar-circle me-3"},at={class:"initials"},st={class:"mb-1"},rt={class:"text-muted mb-0"},ot={class:"content-tabs mb-4"},it={class:"tab-content"},nt={class:"tab-pane fade show active",id:"profile"},lt={class:"card"},ct={class:"card-body"},dt={class:"info-group mb-3"},ut={class:"mb-0"},pt={class:"info-group mb-3"},mt={class:"mb-0"},gt={class:"info-group mb-3"},ht={class:"mb-0"},kt={class:"info-group"},bt={class:"mb-0"},ft={class:"tab-pane fade",id:"addresses"},vt={class:"card"},Lt={class:"card-body"},yt={class:"d-flex justify-content-end mb-3"},wt={class:"address-list"},Ct={class:"address-content"},It={class:"mb-2"},_t={class:"mb-1"},Pt={class:"mb-0"},At={class:"address-actions"},Et=["onClick"],Ft=["onClick"],St={class:"tab-pane fade",id:"orders"},Ot={class:"card"},xt={class:"card-body"},Tt={class:"order-list"},Ut=["onClick"],Dt={class:"order-id"},Nt={class:"order-date"},Rt={class:"order-amount"},$t={key:0,class:"order-details"},Mt=["src","alt"],Xt={class:"product-info"},qt={class:"mb-0"},Wt={class:"product-total"},Bt={class:"text-center"};function Vt(e,t,a,s,o,i){return(0,r.uX)(),(0,r.CE)("div",Ge,[(0,r.Lk)("div",Ze,[(0,r.Lk)("div",Ye,[(0,r.Lk)("div",et,[(0,r.Lk)("div",tt,[(0,r.Lk)("span",at,(0,l.v_)(i.getUserInitials),1)]),(0,r.Lk)("div",null,[(0,r.Lk)("h2",st,(0,l.v_)(o.userInfo.name),1),(0,r.Lk)("p",rt,(0,l.v_)(o.userInfo.email),1)])])]),(0,r.Lk)("div",ot,[t[11]||(t[11]=(0,r.Lk)("ul",{class:"nav nav-pills mb-3",role:"tablist"},[(0,r.Lk)("li",{class:"nav-item",role:"presentation"},[(0,r.Lk)("button",{class:"nav-link active","data-bs-toggle":"pill","data-bs-target":"#profile"},[(0,r.Lk)("i",{class:"fas fa-user me-2"}),(0,r.eW)("個人資料 ")])]),(0,r.Lk)("li",{class:"nav-item",role:"presentation"},[(0,r.Lk)("button",{class:"nav-link","data-bs-toggle":"pill","data-bs-target":"#addresses"},[(0,r.Lk)("i",{class:"fas fa-map-marker-alt me-2"}),(0,r.eW)("收件地址 ")])]),(0,r.Lk)("li",{class:"nav-item",role:"presentation"},[(0,r.Lk)("button",{class:"nav-link","data-bs-toggle":"pill","data-bs-target":"#orders"},[(0,r.Lk)("i",{class:"fas fa-shopping-bag me-2"}),(0,r.eW)("訂單記錄 ")])])],-1)),(0,r.Lk)("div",it,[(0,r.Lk)("div",nt,[(0,r.Lk)("div",lt,[(0,r.Lk)("div",ct,[(0,r.Lk)("div",dt,[t[2]||(t[2]=(0,r.Lk)("label",{class:"text-muted"},"會員姓名",-1)),(0,r.Lk)("p",ut,(0,l.v_)(o.userInfo.name),1)]),(0,r.Lk)("div",pt,[t[3]||(t[3]=(0,r.Lk)("label",{class:"text-muted"},"電子信箱",-1)),(0,r.Lk)("p",mt,(0,l.v_)(o.userInfo.email),1)]),(0,r.Lk)("div",gt,[t[4]||(t[4]=(0,r.Lk)("label",{class:"text-muted"},"聯絡電話",-1)),(0,r.Lk)("p",ht,(0,l.v_)(o.userInfo.phone),1)]),(0,r.Lk)("div",kt,[t[5]||(t[5]=(0,r.Lk)("label",{class:"text-muted"},"聯絡地址",-1)),(0,r.Lk)("p",bt,(0,l.v_)(o.userInfo.address),1)])])])]),(0,r.Lk)("div",ft,[(0,r.Lk)("div",vt,[(0,r.Lk)("div",Lt,[(0,r.Lk)("div",yt,[(0,r.Lk)("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...e)=>i.addRecipient&&i.addRecipient(...e))},t[6]||(t[6]=[(0,r.Lk)("i",{class:"fas fa-plus me-2"},null,-1),(0,r.eW)("新增地址 ")]))]),(0,r.Lk)("div",wt,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.recipients,((e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"address-item"},[(0,r.Lk)("div",Ct,[(0,r.Lk)("h6",It,(0,l.v_)(e.name),1),(0,r.Lk)("p",_t,[t[7]||(t[7]=(0,r.Lk)("i",{class:"fas fa-phone me-2 text-muted"},null,-1)),(0,r.eW)(" "+(0,l.v_)(e.phone),1)]),(0,r.Lk)("p",Pt,[t[8]||(t[8]=(0,r.Lk)("i",{class:"fas fa-map-marker-alt me-2 text-muted"},null,-1)),(0,r.eW)(" "+(0,l.v_)(e.address),1)])]),(0,r.Lk)("div",At,[(0,r.Lk)("button",{class:"btn btn-link",onClick:e=>i.editRecipientInfo(a)},t[9]||(t[9]=[(0,r.Lk)("i",{class:"fas fa-edit"},null,-1)]),8,Et),(0,r.Lk)("button",{class:"btn btn-link text-danger",onClick:e=>i.deleteRecipient(a)},t[10]||(t[10]=[(0,r.Lk)("i",{class:"fas fa-trash"},null,-1)]),8,Ft)])])))),128))])])])]),(0,r.Lk)("div",St,[(0,r.Lk)("div",Ot,[(0,r.Lk)("div",xt,[(0,r.Lk)("div",Tt,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.orders,((e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"order-item"},[(0,r.Lk)("div",{class:"order-header",onClick:e=>i.toggleOrderDetails(t)},[(0,r.Lk)("div",null,[(0,r.Lk)("span",Dt,"#"+(0,l.v_)(e.id),1),(0,r.Lk)("span",Nt,(0,l.v_)(i.formateOrderDate(e.created_at)),1)]),(0,r.Lk)("div",null,[(0,r.Lk)("span",Rt,"NT$ "+(0,l.v_)(Math.round(e.total).toLocaleString()),1),(0,r.Lk)("i",{class:(0,l.C4)(["fas",o.expandedOrder===t?"fa-chevron-up":"fa-chevron-down","ms-2"])},null,2)])],8,Ut),o.expandedOrder===t?((0,r.uX)(),(0,r.CE)("div",$t,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.items,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"order-product"},[(0,r.Lk)("img",{src:e.product_image?`/img/products/${e.product_image}`:"/img/welcome.jpg",alt:e.name,class:"product-img"},null,8,Mt),(0,r.Lk)("div",Xt,[(0,r.Lk)("h6",null,(0,l.v_)(e.name),1),(0,r.Lk)("p",qt," 數量："+(0,l.v_)(e.quantity)+" × NT$ "+(0,l.v_)(e.price),1)]),(0,r.Lk)("div",Wt," NT$ "+(0,l.v_)((e.quantity*e.price).toLocaleString()),1)])))),128))])):(0,r.Q3)("",!0)])))),128))])])])])])]),(0,r.Lk)("div",Bt,[(0,r.Lk)("button",{class:"btn btn-outline-danger",onClick:t[1]||(t[1]=(...e)=>i.handleLogout&&i.handleLogout(...e))},t[12]||(t[12]=[(0,r.Lk)("i",{class:"fas fa-sign-out-alt me-2"},null,-1),(0,r.eW)("登出 ")]))])])])}a(3215);function Kt(e,t="操作失敗",a={}){const{showDetailedError:s=!1,customHandler:r=null}=a;if(console.error("API錯誤:",e),e.response){const{status:a,data:s}=e.response,o=s?.message||t;if(console.error("錯誤回應:",e.response),"function"===typeof r)return r(e);switch(a){case 401:alert("未授權：請重新登入");break;case 404:alert("資源未找到："+o);break;case 500:alert("伺服器錯誤，請稍後再試");break;default:alert(o)}}else e.request?(console.error("未收到伺服器響應:",e.request),alert("無法連接到伺服器，請檢查網絡")):(console.error("未知錯誤:",e.message),alert(t))}const{userAPI:jt,recipientAPI:Qt}=ne.A;var Jt={name:"MemberPage",data(){return{showRecipient:!1,expandedOrder:null,isEditing:!1,isLoadingRecipients:!1,recipients:[],editRecipient:{name:" ",phone:" ",address:" "},editingIndex:-1,userInfo:{name:" ",email:" ",phone:"",address:""},orders:[]}},computed:{...(0,R.aH)("auth",{isLoggedIn:e=>e.isLoggedIn,user:e=>e.user||{}}),filteredOrders(){return this.orders.map((e=>({...e,formattedDate:this.formatOrderDate(e.created_at)})))},getUserInitials(){return this.userInfo.name?this.userInfo.name.substring(0,2).toUpperCase():"??"}},async mounted(){try{if(!this.isLoggedIn)return alert("請先登入會員！"),void this.$router.push("/UserLogin");await Promise.all([this.loadUserInfo(),this.loadOrders(),this.loadRecipients()])}catch(e){Kt(e,"加載用戶信息失敗，請重試。")}},methods:{async loadUserInfo(){try{const e=this.user.id;if(console.log("用戶 ID:",e),!e)return void console.error("用戶ID無效");const t=await ne.A.userAPI.getUserInfo(e);this.userInfo=t.data,console.log("用戶資料",this.userInfo)}catch(e){console.error("加載用戶信息時出錯:",e),Kt(e,"加載用戶信息失敗，請重試。")}},async loadOrders(){try{const e=await ne.A.userAPI.getOrders();e.success&&(this.orders=e.data)}catch(e){console.error("載入訂單失敗:",e)}},async loadRecipients(){try{this.isLoadingRecipients=!0;const e=await ne.A.recipientAPI.getRecipients(this.user.id);this.recipients=Array.isArray(e.data)?e.data:[]}catch(e){console.error("載入收件人資料失敗:",e),Kt(e,"載入收件人資料失敗")}finally{this.isLoadingRecipients=!1}},isRecipientValid(e){const t=/^[0-9]{10}$/;return e.name.trim()&&t.test(e.phone)&&e.address.trim()},async saveRecipient(){if(this.isRecipientValid(this.editRecipient))try{let e;this.isEditing?(e=await ne.A.recipientAPI.updateRecipient(this.editRecipient.id,this.editRecipient),e.success&&(this.recipients[this.editingIndex]=e.data)):(e=await ne.A.recipientAPI.addRecipient({...this.editRecipient,user_id:this.user.id}),e.success&&this.recipients.push(e.data)),this.hideModal(),alert(this.isEditing?"收件人資料已更新":"新增收件人成功")}catch(e){Kt(e,this.isEditing?"更新收件人失敗":"新增收件人失敗")}else alert("請檢查收件人資料是否完整且格式正確！")},async deleteRecipient(e){if(confirm("確定要刪除此收件人資料？"))try{const t=this.recipients[e].id,a=await ne.A.recipientAPI.deleteRecipient(t);a.success&&(this.recipients.splice(e,1),alert("收件人資料已刪除"))}catch(t){Kt(t,"刪除收件人敗")}},toggleRecipient(){this.showRecipient=!this.showRecipient},addRecipient(){this.isEditing=!1,this.editRecipient={name:"",phone:"",address:""},this.showModal()},editRecipientInfo(e){this.isEditing=!0,this.editingIndex=e,this.editRecipient={...this.recipients[e]},this.showModal()},toggleOrderDetails(e){const t=this.orders[e];if(!t.items||!t.items.length)return void alert("該訂單無法顯示細節！");const a=e=>e.product_name&&e.quantity>0&&e.price>=0;t.items.every(a)?this.expandedOrder=this.expandedOrder===e?null:e:alert("該訂單數據不完整，無法展開！")},showModal(){if(this.$refs.recipientModal){const e=new K.aF(this.$refs.recipientModal);e.show()}},hideModal(){const e=K.aF.getInstance(this.$refs.recipientModal);e&&e.hide()},...(0,R.i0)("auth",["logout"]),async handleLogout(){await this.logout(),alert("已成功登出!"),this.$router.push("/UserLogin")},formateOrderDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-TW",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})},getOrderStatusClass(e){const t={pending:"badge bg-warning text-dark",processing:"badge bg-info text-white",shipped:"badge bg-primary text-white",completed:"badge bg-success text-white",cancelled:"badge bg-danger text-white"};return t[e]||"badge bg-secondary"},getOrderStatusText(e){const t={pending:"處理中",processing:"處理中",shipped:"已出貨",completed:"已完成",cancelled:"已取消"};return t[e]||"未知狀態"}}};const zt=(0,I.A)(Jt,[["render",Vt],["__scopeId","data-v-96590a94"]]);var Ht=zt;function Gt(e,t,a,s,o,i){return t[0]||(t[0]=(0,r.Fv)('<div class="faq-search" data-v-7a8228db><input type="text" class="form-control" id="faqSearch" placeholder="搜尋問題..." data-v-7a8228db></div><div class="accordion" id="faqAccordion" data-v-7a8228db><div class="accordion-item faq-item" data-v-7a8228db><h2 class="accordion-header" id="headingOne" data-v-7a8228db><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne" data-v-7a8228db> 問題一：如何註冊？ </button></h2><div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#faqAccordion" data-v-7a8228db><div class="accordion-body" data-v-7a8228db> 您可以點擊右上角的「註冊」按鈕，並按照提示填寫相關資訊來完成註冊。 </div></div></div><div class="accordion-item faq-item" data-v-7a8228db><h2 class="accordion-header" id="headingTwo" data-v-7a8228db><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo" data-v-7a8228db> 問題二：忘記密碼怎麼辦？ </button></h2><div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#faqAccordion" data-v-7a8228db><div class="accordion-body" data-v-7a8228db> 您可以點擊「忘記密碼」連結，輸入您的電子郵件，系統將發送密碼重置的指引給您。 </div></div></div></div><div class="contact-container contact" data-v-7a8228db><div class="contact-info" data-v-7a8228db><h4 data-v-7a8228db>或者透過以下表格聯絡</h4></div><div class="contact-form" data-v-7a8228db><form data-v-7a8228db><div class="mb-3" data-v-7a8228db><label for="name" class="form-label" data-v-7a8228db>姓名</label><input type="text" class="form-control" id="name" placeholder="請輸入您的姓名" data-v-7a8228db></div><div class="mb-3" data-v-7a8228db><label for="email" class="form-label" data-v-7a8228db>電子郵件</label><input type="email" class="form-control" id="email" placeholder="請輸入您的電子郵件" data-v-7a8228db></div><div class="mb-3" data-v-7a8228db><label for="message" class="form-label" data-v-7a8228db>留言</label><textarea class="form-control" id="message" rows="4" placeholder="請輸入您的訊息" data-v-7a8228db></textarea></div><button type="submit" class="btn btn-primary" data-v-7a8228db>送出</button></form></div></div>',3))}var Zt={name:"ContactUs",mounted(){const e=document.getElementById("faqSearch");e&&e.addEventListener("input",(function(){const e=this.ariaValueMax.toLowerCase();document.querySelectorAll(".faq-item").forEach((function(t){const a=t.querySelector("according-button").innerText.toLowerCase(),s=t.querySelector(".according-body").innerText.toLowerCase();a.includes(e)||s.includes(e)?t.style.display="block":t.style.display="none"}))}))}};const Yt=(0,I.A)(Zt,[["render",Gt],["__scopeId","data-v-7a8228db"]]);var ea=Yt;function ta(e,t,a,s,o,i){return(0,r.uX)(),(0,r.CE)("div",null,[t[0]||(t[0]=(0,r.Lk)("h1",null,"搜尋結果",-1)),(0,r.Lk)("p",null,"搜尋關鍵字："+(0,l.v_)(i.searchQuery),1)])}var aa={name:"SearchResults",computed:{searchQuery(){return this.$route.query.q||"未指定"}}};const sa=(0,I.A)(aa,[["render",ta]]);var ra=sa;const oa={class:"register-page"},ia={class:"register-container container"},na={class:"auth-card"},la={class:"row g-3"},ca={class:"col-12"},da={class:"form-floating"},ua={class:"col-12"},pa={class:"form-floating"},ma={class:"col-12"},ga={class:"form-floating"},ha={class:"col-12"},ka={class:"form-floating"},ba={class:"col-12"},fa={class:"form-floating password-wrapper"},va=["type"],La={class:"col-12"},ya={class:"form-floating"},wa={key:0,class:"alert alert-danger mt-3"},Ca={class:"mb-0"},Ia={class:"text-center mt-3"},_a={class:"mb-0"};function Pa(e,t,a,o,i,n){const c=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",oa,[(0,r.Lk)("div",ia,[(0,r.Lk)("div",na,[t[17]||(t[17]=(0,r.Lk)("div",{class:"auth-header text-center mb-4"},[(0,r.Lk)("h2",{class:"fw-bold text-primary"},"會員註冊"),(0,r.Lk)("p",{class:"text-muted"},"創建您的帳號，開始購物之旅")],-1)),(0,r.Lk)("form",{onSubmit:t[7]||(t[7]=(0,s.D$)(((...e)=>n.handleRegister&&n.handleRegister(...e)),["prevent"])),class:"auth-form"},[(0,r.Lk)("div",la,[(0,r.Lk)("div",ca,[(0,r.Lk)("div",da,[(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",id:"username","onUpdate:modelValue":t[0]||(t[0]=e=>i.username=e),placeholder:"請輸入姓名",required:""},null,512),[[s.Jo,i.username]]),t[8]||(t[8]=(0,r.Lk)("label",{for:"username"},"會員姓名",-1))])]),(0,r.Lk)("div",ua,[(0,r.Lk)("div",pa,[(0,r.bo)((0,r.Lk)("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[1]||(t[1]=e=>i.email=e),placeholder:"請輸入電子信箱",required:""},null,512),[[s.Jo,i.email]]),t[9]||(t[9]=(0,r.Lk)("label",{for:"email"},"電子郵件",-1))])]),(0,r.Lk)("div",ma,[(0,r.Lk)("div",ga,[(0,r.bo)((0,r.Lk)("input",{type:"tel",class:"form-control",id:"phone","onUpdate:modelValue":t[2]||(t[2]=e=>i.phone=e),placeholder:"請輸入手機號碼",required:""},null,512),[[s.Jo,i.phone]]),t[10]||(t[10]=(0,r.Lk)("label",{for:"phone"},"手機號碼",-1))])]),(0,r.Lk)("div",ha,[(0,r.Lk)("div",ka,[(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",id:"address","onUpdate:modelValue":t[3]||(t[3]=e=>i.address=e),placeholder:"請輸入收件地址",required:""},null,512),[[s.Jo,i.address]]),t[11]||(t[11]=(0,r.Lk)("label",{for:"address"},"收件地址",-1))])]),(0,r.Lk)("div",ba,[(0,r.Lk)("div",fa,[(0,r.bo)((0,r.Lk)("input",{type:i.showPassword?"text":"password",class:"form-control",id:"password","onUpdate:modelValue":t[4]||(t[4]=e=>i.password=e),placeholder:"請設定密碼",required:""},null,8,va),[[s.hp,i.password]]),t[12]||(t[12]=(0,r.Lk)("label",{for:"password"},"密碼",-1)),(0,r.Lk)("button",{type:"button",class:"btn btn-link password-toggle",onClick:t[5]||(t[5]=e=>i.showPassword=!i.showPassword)},[(0,r.Lk)("i",{class:(0,l.C4)(i.showPassword?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),(0,r.Lk)("div",La,[(0,r.Lk)("div",ya,[(0,r.bo)((0,r.Lk)("input",{type:"password",class:"form-control",id:"confirmpassword","onUpdate:modelValue":t[6]||(t[6]=e=>i.confirmpassword=e),placeholder:"請再次輸入密碼",required:""},null,512),[[s.Jo,i.confirmpassword]]),t[13]||(t[13]=(0,r.Lk)("label",{for:"confirmpassword"},"確認密碼",-1))])])]),i.formErrors.length?((0,r.uX)(),(0,r.CE)("div",wa,[(0,r.Lk)("ul",Ca,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.formErrors,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e},(0,l.v_)(e),1)))),128))])])):(0,r.Q3)("",!0),t[16]||(t[16]=(0,r.Lk)("button",{type:"submit",class:"btn btn-primary w-100 mt-4"},[(0,r.Lk)("i",{class:"fas fa-user-plus me-2"}),(0,r.eW)("註冊 ")],-1)),(0,r.Lk)("div",Ia,[(0,r.Lk)("p",_a,[t[15]||(t[15]=(0,r.eW)("已經有帳號？ ")),(0,r.bF)(c,{to:"/UserLogin",class:"text-primary text-decoration-none"},{default:(0,r.k6)((()=>t[14]||(t[14]=[(0,r.eW)(" 立即登入 ")]))),_:1})])])],32)])])])}var Aa={name:"UserRegister",data(){return{username:"",phone:"",address:"",email:"",password:"",confirmpassword:"",formErrors:[],showPassword:!1}},methods:{async handleRegister(){try{this.formErrors=[];const e=this.validateForm();if(e.length>0)return void(this.formErrors=e);const t=await ne.A.userAPI.register({name:this.sanitizeInput(this.username),phone:this.sanitizeInput(this.phone),address:this.sanitizeInput(this.address),email:this.sanitizeInput(this.email),password:this.sanitizeInput(this.password),role:"user"});t.success&&(alert("註冊成功"),this.$router.push("/UserLogin"))}catch(e){Kt(e,"註冊失敗，請稍後再試")}},validateForm(){const e=[];return this.username.trim()?this.username.length<2&&e.push("會員姓名至少需要2個字元"):e.push("請輸入會員姓名"),this.validatePhoneNumber(this.phone)||e.push("請輸入正確的手機號碼格式（10位數字）"),this.address.trim()?this.address.length<8&&e.push("地址需要更詳細"):e.push("請輸入地址"),this.validateEmail(this.email)||e.push("請輸入正確的電子郵件格式"),this.password?this.password.length<6?e.push("密碼長��需至少為6個字元"):/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/.test(this.password)||e.push("密碼需包含至少一個字母和一個數字"):e.push("請設定密碼"),this.password!==this.confirmpassword&&e.push("兩次密碼不相符"),e},validatePhoneNumber(e){const t=/^09\d{8}$/;return t.test(e)},validateEmail(e){const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.test(e)},sanitizeInput(e){return"string"!==typeof e?"":e.trim().replace(/<[^>]*>/g,"").replace(/[<>]/g,"")}}};const Ea=(0,I.A)(Aa,[["render",Pa],["__scopeId","data-v-7e1390a9"]]);var Fa=Ea;const Sa={class:"login-page"},Oa={class:"login-container container"},xa={class:"auth-card"},Ta={class:"form-floating mb-3"},Ua={class:"form-floating mb-3"},Da=["type"],Na={class:"d-flex justify-content-between align-items-center mb-4"},Ra={class:"text-center"},$a={class:"mb-0"};function Ma(e,t,a,o,i,n){const c=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",Sa,[(0,r.Lk)("div",Oa,[(0,r.Lk)("div",xa,[t[11]||(t[11]=(0,r.Lk)("div",{class:"auth-header text-center mb-4"},[(0,r.Lk)("h2",{class:"fw-bold text-primary"},"會員登入"),(0,r.Lk)("p",{class:"text-muted"},"歡迎回來，請登入您的帳號")],-1)),(0,r.Lk)("form",{onSubmit:t[3]||(t[3]=(0,s.D$)(((...e)=>n.handleLogin&&n.handleLogin(...e)),["prevent"])),class:"auth-form"},[(0,r.Lk)("div",Ta,[(0,r.bo)((0,r.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>i.email=e),class:"form-control",placeholder:"請輸入電子郵件",required:""},null,512),[[s.Jo,i.email]]),t[4]||(t[4]=(0,r.Lk)("label",{for:"email"},"電子郵件",-1))]),(0,r.Lk)("div",Ua,[(0,r.bo)((0,r.Lk)("input",{type:i.showPassword?"text":"password",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>i.password=e),class:"form-control",placeholder:"請輸入密碼",required:""},null,8,Da),[[s.hp,i.password]]),t[5]||(t[5]=(0,r.Lk)("label",{for:"password"},"密碼",-1)),(0,r.Lk)("button",{type:"button",class:"btn btn-link password-toggle",onClick:t[2]||(t[2]=e=>i.showPassword=!i.showPassword)},[(0,r.Lk)("i",{class:(0,l.C4)(i.showPassword?"fas fa-eye-slash":"fas fa-eye")},null,2)])]),(0,r.Lk)("div",Na,[t[7]||(t[7]=(0,r.Lk)("div",{class:"form-check"},[(0,r.Lk)("input",{type:"checkbox",class:"form-check-input",id:"remember"}),(0,r.Lk)("label",{class:"form-check-label",for:"remember"},"記住我")],-1)),(0,r.bF)(c,{to:"/ForgotPwd",class:"text-primary text-decoration-none"},{default:(0,r.k6)((()=>t[6]||(t[6]=[(0,r.eW)(" 忘記密碼？ ")]))),_:1})]),t[10]||(t[10]=(0,r.Lk)("button",{type:"submit",class:"btn btn-primary w-100 mb-3"},[(0,r.Lk)("i",{class:"fas fa-sign-in-alt me-2"}),(0,r.eW)("登入 ")],-1)),(0,r.Lk)("div",Ra,[(0,r.Lk)("p",$a,[t[9]||(t[9]=(0,r.eW)("還沒有帳號？ ")),(0,r.bF)(c,{to:"/UserRegister",class:"text-primary text-decoration-none"},{default:(0,r.k6)((()=>t[8]||(t[8]=[(0,r.eW)(" 立即註冊 ")]))),_:1})])])],32)])])])}var Xa={name:"UserLogin",data(){return{email:"",password:"",showPassword:!1}},methods:{...(0,R.i0)("auth",["login"]),async handleLogin(){try{const e=await this.login({email:this.email,password:this.password}),t=e.data;if(t){console.log("找到的用戶",t),alert("登入成功!歡迎"+t.name);const e=this.$route.query.redirect;"admin"===t.role.toLowerCase()?e&&e.startsWith("/admin")?this.$router.push(e):this.$router.push("/admin"):"user"===t.role.toLowerCase()?e&&!e.startsWith("/admin")?this.$router.push(e):this.$router.push("/MembersPage"):alert("帳號或密碼錯誤")}}catch(e){Kt(e,"登入失敗，請稍後再試")}}}};const qa=(0,I.A)(Xa,[["render",Ma],["__scopeId","data-v-4d007a45"]]);var Wa=qa;const Ba={class:"container"},Va={class:"mb-3"};function Ka(e,t,a,o,i,n){return(0,r.uX)(),(0,r.CE)("div",Ba,[t[4]||(t[4]=(0,r.Lk)("h5",null,"忘記密碼",-1)),(0,r.Lk)("form",{onSubmit:t[1]||(t[1]=(0,s.D$)(((...e)=>n.handleForgotPassword&&n.handleForgotPassword(...e)),["prevent"]))},[(0,r.Lk)("div",Va,[t[2]||(t[2]=(0,r.Lk)("label",{for:"email",class:"form-label"},"電子郵件",-1)),(0,r.bo)((0,r.Lk)("input",{type:"email","onUpdate:modelValue":t[0]||(t[0]=e=>i.email=e),class:"form-control",id:"email",required:""},null,512),[[s.Jo,i.email]])]),t[3]||(t[3]=(0,r.Lk)("button",{type:"submit",class:"btn btn-primary"},"發送重設密碼連結信",-1))],32)])}var ja=a(4373),Qa={name:"ForgotPwd",data(){return{email:""}},methods:{async handleForgotPassword(){try{const e=this.$route.params.token;await ja.A.post(`/api/reset-password/${e}`,{newPassword:this.newPassword}),alert("密碼已成功重新設置！"),this.$router.push("/login")}catch(e){console.error("重設密碼錯誤,error"),alert("重設密碼失敗")}}}};const Ja=(0,I.A)(Qa,[["render",Ka]]);var za=Ja;const Ha={class:"order-confirmation container mt-5"},Ga={key:0,class:"text-center"},Za={key:1,class:"text-center"},Ya={key:2};function es(e,t,a,s,o,i){const n=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",Ha,[t[3]||(t[3]=(0,r.Lk)("h2",{class:"text-center mb-4"},"訂單確認",-1)),s.isLoading?((0,r.uX)(),(0,r.CE)("div",Ga,t[0]||(t[0]=[(0,r.Lk)("p",null,"正在加載訂單詳情...",-1)]))):s.orderDetails?((0,r.uX)(),(0,r.CE)("div",Ya,[(0,r.Lk)("p",null,"感謝您的購買，您的訂單編號是："+(0,l.v_)(s.orderId),1),(0,r.bF)(n,{to:"/",class:"btn btn-primary mt-3"},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)("繼續購物！")]))),_:1})])):((0,r.uX)(),(0,r.CE)("div",Za,t[1]||(t[1]=[(0,r.Lk)("p",null,"無法加載訂單詳情，請稍後再試。",-1)])))])}var ts={name:"OrderConfirmation",setup(){const e=(0,Q.lq)(),t=(0,R.Pj)(),a=(0,Q.rd)(),s=e.params.orderId,o=(0,we.KR)(null),i=(0,we.KR)(!0),n=async()=>{i.value=!0;const e=/^[1-9]\d*$/.test(s);if(!e)return console.error("訂單編號格式不正確:",s),t.dispatch("notifications/showNotification",{type:"error",message:"訂單編號格式不正確，無法加載訂單詳情。"}),a.push("/").catch((e=>{"NavigationDuplicated"!==e.name&&console.error(e)})),void(i.value=!1);try{const e=await ne.A.orderAPI.getOrderById(s);if(!e||!e.id)return console.error("訂單詳情數據不完整"),t.dispatch("notifications/showNotification",{type:"error",message:"訂單資料不完整，請聯繫客服。"}),void(i.value=!1);o.value=e}catch(r){r.response&&404===r.response.status?(console.error("訂單不存在",r),t.dispatch("notifications/showNotification",{type:"error",message:"訂單不存在，請確認您的訂單編號。"})):(console.error("加載訂單詳情時出錯",r),t.dispatch("notifications/showNotification",{type:"error",message:"加載訂單詳情時出錯，請稍後再試！"})),o.value=null}finally{i.value=!1}};return(0,r.sV)((()=>{if(!s)return console.error("訂單編號缺失"),void a.push("/").catch((e=>{"NavigationDuplicated"!==e.name&&console.error(e)}));n()})),{orderId:s,orderDetails:o,isLoading:i}}};const as=(0,I.A)(ts,[["render",es],["__scopeId","data-v-03bd47ad"]]);var ss=as;const rs={class:"admin-dashboard container py-4"},os={class:"quick-actions mb-4"},is={class:"row g-3"},ns={class:"col-md-3 col-sm-6"},ls={class:"col-md-3 col-sm-6"},cs={class:"col-md-3 col-sm-6"},ds={class:"col-md-3 col-sm-6"},us={class:"stats-overview mb-4"},ps={class:"row g-3"},ms={class:"col-md-3 col-sm-6"},gs={class:"stat-card"},hs={class:"stat-info"},ks={class:"col-md-3 col-sm-6"},bs={class:"stat-card"},fs={class:"stat-info"},vs={class:"col-md-3 col-sm-6"},Ls={class:"stat-card"},ys={class:"stat-info"},ws={class:"col-md-3 col-sm-6"},Cs={class:"stat-card"},Is={class:"stat-info"},_s={class:"row g-4 mb-4"},Ps={class:"col-md-6"},As={class:"card shadow-sm h-100"},Es={class:"card-body"},Fs={class:"comparison-item"},Ss={class:"d-flex justify-content-between mb-2"},Os={class:"fw-bold"},xs={class:"d-flex justify-content-between mb-2"},Ts={class:"fw-bold"},Us={class:"d-flex justify-content-between"},Ds={class:"fw-bold"},Ns={class:"col-md-6"},Rs={class:"card shadow-sm h-100"},$s={class:"card-body"},Ms={class:"comparison-item"},Xs={class:"d-flex justify-content-between mb-2"},qs={class:"fw-bold"},Ws={class:"d-flex justify-content-between"},Bs={class:"fw-bold"};function Vs(e,t,a,s,o,i){const n=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",rs,[t[19]||(t[19]=(0,r.Lk)("div",{class:"dashboard-header mb-4"},[(0,r.Lk)("h2",{class:"fw-bold text-primary"},"管理後台儀表板"),(0,r.Lk)("p",{class:"text-muted"},"查看網站營運概況與重要數據")],-1)),(0,r.Lk)("div",os,[(0,r.Lk)("div",is,[(0,r.Lk)("div",ns,[(0,r.bF)(n,{to:"/admin/CarouselImages",class:"quick-action-card"},{default:(0,r.k6)((()=>t[0]||(t[0]=[(0,r.Lk)("i",{class:"fas fa-images"},null,-1),(0,r.Lk)("span",null,"輪播圖片管理",-1)]))),_:1})]),(0,r.Lk)("div",ls,[(0,r.bF)(n,{to:"/admin/products",class:"quick-action-card"},{default:(0,r.k6)((()=>t[1]||(t[1]=[(0,r.Lk)("i",{class:"fas fa-box"},null,-1),(0,r.Lk)("span",null,"商品管理",-1)]))),_:1})]),(0,r.Lk)("div",cs,[(0,r.bF)(n,{to:"/admin/orders",class:"quick-action-card"},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.Lk)("i",{class:"fas fa-shopping-cart"},null,-1),(0,r.Lk)("span",null,"訂單管理",-1)]))),_:1})]),(0,r.Lk)("div",ds,[(0,r.bF)(n,{to:"/admin/users",class:"quick-action-card"},{default:(0,r.k6)((()=>t[3]||(t[3]=[(0,r.Lk)("i",{class:"fas fa-users"},null,-1),(0,r.Lk)("span",null,"使用者管理",-1)]))),_:1})])])]),(0,r.Lk)("div",us,[(0,r.Lk)("div",ps,[(0,r.Lk)("div",ms,[(0,r.Lk)("div",gs,[t[5]||(t[5]=(0,r.Lk)("div",{class:"stat-icon bg-primary"},[(0,r.Lk)("i",{class:"fas fa-shopping-bag"})],-1)),(0,r.Lk)("div",hs,[(0,r.Lk)("h3",null,(0,l.v_)(o.todayOrders),1),t[4]||(t[4]=(0,r.Lk)("p",null,"今日訂單數",-1))])])]),(0,r.Lk)("div",ks,[(0,r.Lk)("div",bs,[t[7]||(t[7]=(0,r.Lk)("div",{class:"stat-icon bg-success"},[(0,r.Lk)("i",{class:"fas fa-dollar-sign"})],-1)),(0,r.Lk)("div",fs,[(0,r.Lk)("h3",null,(0,l.v_)(i.formatNumber(o.todaySales)),1),t[6]||(t[6]=(0,r.Lk)("p",null,"今日銷售額",-1))])])]),(0,r.Lk)("div",vs,[(0,r.Lk)("div",Ls,[t[9]||(t[9]=(0,r.Lk)("div",{class:"stat-icon bg-info"},[(0,r.Lk)("i",{class:"fas fa-user-plus"})],-1)),(0,r.Lk)("div",ys,[(0,r.Lk)("h3",null,(0,l.v_)(o.todayNewMembers),1),t[8]||(t[8]=(0,r.Lk)("p",null,"今日新會員",-1))])])]),(0,r.Lk)("div",ws,[(0,r.Lk)("div",Cs,[t[11]||(t[11]=(0,r.Lk)("div",{class:"stat-icon bg-warning"},[(0,r.Lk)("i",{class:"fas fa-users"})],-1)),(0,r.Lk)("div",Is,[(0,r.Lk)("h3",null,(0,l.v_)(o.totalMembers),1),t[10]||(t[10]=(0,r.Lk)("p",null,"總會員數",-1))])])])])]),t[20]||(t[20]=(0,r.Fv)('<div class="card shadow-sm mb-4" data-v-82bf2296><div class="card-body" data-v-82bf2296><h5 class="card-title mb-4" data-v-82bf2296><i class="fas fa-chart-line me-2" data-v-82bf2296></i>銷售趨勢 </h5><div class="chart-container" data-v-82bf2296><canvas id="salesChart" data-v-82bf2296></canvas></div></div></div>',1)),(0,r.Lk)("div",_s,[(0,r.Lk)("div",Ps,[(0,r.Lk)("div",As,[(0,r.Lk)("div",Es,[t[15]||(t[15]=(0,r.Lk)("h5",{class:"card-title mb-3"},[(0,r.Lk)("i",{class:"fas fa-calendar-day me-2"}),(0,r.eW)("銷售比較 ")],-1)),(0,r.Lk)("div",Fs,[(0,r.Lk)("div",Ss,[t[12]||(t[12]=(0,r.Lk)("span",null,"今日銷售額",-1)),(0,r.Lk)("span",Os,(0,l.v_)(i.formatNumber(o.todaySales)),1)]),(0,r.Lk)("div",xs,[t[13]||(t[13]=(0,r.Lk)("span",null,"昨日銷售額",-1)),(0,r.Lk)("span",Ts,(0,l.v_)(i.formatNumber(o.yesterdaySales)),1)]),(0,r.Lk)("div",Us,[t[14]||(t[14]=(0,r.Lk)("span",null,"近7日銷售額",-1)),(0,r.Lk)("span",Ds,(0,l.v_)(i.formatNumber(o.last7DaySales)),1)])])])])]),(0,r.Lk)("div",Ns,[(0,r.Lk)("div",Rs,[(0,r.Lk)("div",$s,[t[18]||(t[18]=(0,r.Lk)("h5",{class:"card-title mb-3"},[(0,r.Lk)("i",{class:"fas fa-user-friends me-2"}),(0,r.eW)("會員統計 ")],-1)),(0,r.Lk)("div",Ms,[(0,r.Lk)("div",Xs,[t[16]||(t[16]=(0,r.Lk)("span",null,"今日新增會員",-1)),(0,r.Lk)("span",qs,(0,l.v_)(o.todayNewMembers),1)]),(0,r.Lk)("div",Ws,[t[17]||(t[17]=(0,r.Lk)("span",null,"累計會員總數",-1)),(0,r.Lk)("span",Bs,(0,l.v_)(o.totalMembers),1)])])])])])])])}a(8872);var Ks=a(3456),js={name:"AdminDashboard",data(){return{todayOrders:0,todaySales:0,yesterdaySales:0,last7DaySales:0,salesData:[],lowStockProducts:[],todayNewMembers:0,totalMembers:0,carouselImages:[],products:[],sevenDaySalesRanking:[],monthSalesRanking:[],socket:null}},async mounted(){await this.loadDashboardData(),this.renderSalesChart()},methods:{async loadDashboardData(){try{const[e,t,a]=await Promise.all([ne.A.orderAPI.getOrders(),ne.A.userAPI.getAllUsers(),ne.A.productAPI.getAllProducts()]),s=e.data,r=t.data,o=a.data;this.products=o;const i=new Date,n=i.toISOString().split("T")[0];this.todayOrders=s.filter((e=>e.order_date.split("T")[0]===n)).length;const l=new Date;l.setDate(l.getDate()-1);const c=l.toISOString().split("T")[0],d=new Date;d.setDate(d.getDate()-7);const u=d.toISOString().split("T")[0];this.todaySales=s.filter((e=>e.order_date.split("T")[0]===n)).reduce(((e,t)=>e+Number(t.total)),0),this.yesterdaySales=s.filter((e=>e.order_date.split("T")[0]===c)).reduce(((e,t)=>e+Number(t.total)),0),this.last7DaySales=s.filter((e=>e.order_date.split("T")[0]>=u&&e.order_date.split("T")[0]<=n)).reduce(((e,t)=>e+Number(t.total)),0);const p={};s.forEach((e=>{const t=e.order_date.split("T")[0],a=Number(e.total);p[t]?p[t]+=a:p[t]=a})),this.salesData=Object.keys(p).map((e=>({date:e,amount:p[e]}))).sort(((e,t)=>new Date(e.date)-new Date(t.date))),this.todayNewMembers=r.filter((e=>{if(e.created_at){const t=new Date(e.created_at).toISOString().split("T")[0];return t===n}return!1})).length,this.totalMembers=r.length}catch(e){console.error("加載儀表板數據時出錯：",e),alert("加載儀表板數據時出錯，請稍後再試！")}},renderSalesChart(){if(!this.salesData||0===this.salesData.length)return void console.error("銷售數據未加載！");const e=document.getElementById("salesChart").getContext("2d");this.chart&&this.chart.destroy(),this.chart=new Ks.Ay(e,{type:"line",data:{labels:this.salesData.map((e=>e.date)),datasets:[{label:"銷售金額",data:this.salesData.map((e=>e.amount)),borderColor:"rgba(75,192,192,1)",backgroundColor:"rgba(75,192,192,0.1)",borderWidth:2,fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){let t=e.dataset.label||"";return t&&(t+=": "),null!==e.parsed.y&&(t+=new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0}).format(e.parsed.y)),t}}}},scales:{x:{grid:{display:!1},ticks:{maxRotation:45,minRotation:45}},y:{beginAtZero:!0,ticks:{callback:function(e){return new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0}).format(e)}}}}}})},formatNumber(e){return Number(e).toLocaleString("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).replace(/^NT\$\s?/,"")},initWebSocket(){this.socket=new WebSocket("ws://localhost:5002/ws/admin"),this.socket.onmessage=e=>{const t=JSON.parse(e.data);"newOrder"===t.type&&this.updateDashboardData()}},updateDashboardData(e){const t=new Date,a=t.Date(e.created_at);e.order_date.split("T")[0]===a&&(this.todayOrders++,this.todaySales+=Number(e.total))}}};const Qs=(0,I.A)(js,[["render",Vs],["__scopeId","data-v-82bf2296"]]);var Js=Qs;const zs={class:"admin-dashboard container mt-5"},Hs={class:"d-flex justify-content-between align-items-center mb-4"},Gs={class:"btn-group shadow-sm"},Zs={key:0,class:"accordion",id:"productAccordion"},Ys={class:"accordion-item"},er={class:"accordion-header",id:"headingProducts"},tr={class:"accordion-body"},ar={class:"card-header bg-white d-flex justify-content-between align-items-center mb-3"},sr={class:"d-flex align-items-center"},rr=["value"],or={class:"card-footer bg-white d-flex justify-content-between align-items-center"},ir=["disabled"],nr=["disabled"],lr={class:"table"},cr={class:"product-name-container text-truncate",style:{"max-width":"150px"}},dr={class:"product-name mb-1"},ur=["onClick"],pr={class:"text-nowrap text-center"},mr={class:"product-description-container"},gr=["onClick"],hr={class:"text-center align-middle"},kr={class:"d-flex justify-content-center"},br=["onClick"],fr={class:"row mt-5"},vr={class:"col-md-6"},Lr={class:"accordion",id:"tagAccordion"},yr={class:"accordion-item"},wr={class:"accordion-header",id:"headingTags"},Cr={class:"accordion-body"},Ir={class:"d-flex justify-content-end mb-3"},_r={class:"table"},Pr=["onClick"],Ar=["onClick"],Er={class:"col-md-6"},Fr={class:"accordion",id:"brandAccordion"},Sr={class:"accordion-item"},Or={class:"accordion-header",id:"headingBrands"},xr={class:"accordion-body"},Tr={class:"d-flex justify-content-end mb-3"},Ur={class:"table"},Dr=["onClick"],Nr=["onClick"],Rr={class:"modal fade",tabindex:"-1",ref:"tagModal"},$r={class:"modal-dialog"},Mr={class:"modal-content"},Xr={class:"modal-header"},qr={class:"modal-body"},Wr={class:"modal-footer"},Br={class:"modal fade",tabindex:"-1",ref:"brandModal"},Vr={class:"modal-dialog"},Kr={class:"modal-content"},jr={class:"modal-header"},Qr={class:"modal-body"},Jr={class:"modal-footer"};function zr(e,t,a,o,i,n){const c=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Lk)("div",zs,[t[24]||(t[24]=(0,r.Lk)("h2",{class:"text-center"},"商品管理",-1)),(0,r.Lk)("div",Hs,[(0,r.Lk)("div",Gs,[(0,r.bF)(c,{to:"/admin/CreateProduct",class:"btn btn-success d-flex align-items-center"},{default:(0,r.k6)((()=>t[16]||(t[16]=[(0,r.Lk)("i",{class:"bi bi-plus-circle me-2"},null,-1),(0,r.eW)("新增商品 ")]))),_:1}),(0,r.bF)(c,{to:"/admin/SpecialOffers",class:"btn btn-primary d-flex align-items-center"},{default:(0,r.k6)((()=>t[17]||(t[17]=[(0,r.Lk)("i",{class:"bi bi-tag me-2"},null,-1),(0,r.eW)("特價商品 ")]))),_:1})])]),i.isSectionOpen.products?((0,r.uX)(),(0,r.CE)("div",Zs,[(0,r.Lk)("div",Ys,[(0,r.Lk)("h2",er,[(0,r.Lk)("button",{class:"accordion-button",type:"button",onClick:t[0]||(t[0]=e=>n.toggleSection("products"))}," 商品管理 ")]),(0,r.Lk)("div",{class:(0,l.C4)(["accordion-collapse collapse show",{show:i.isSectionOpen.products}]),"aria-labelledby":"headingProducts","data-bs-parent":"#productAccordion"},[(0,r.Lk)("div",tr,[(0,r.Lk)("div",ar,[t[19]||(t[19]=(0,r.Lk)("h5",{class:"mb-0"},"商品清單",-1)),(0,r.Lk)("div",sr,[t[18]||(t[18]=(0,r.Lk)("label",{class:"me-2"},"每頁顯示：",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.itemsPerPage=e),class:"form-select form-select-sm w-auto"},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.itemsPerPageOptions,(e=>((0,r.uX)(),(0,r.CE)("option",{key:e,value:e},(0,l.v_)(e),9,rr)))),128))],512),[[s.u1,i.itemsPerPage,void 0,{number:!0}]])]),(0,r.Lk)("div",or,[(0,r.Lk)("div",null,"第 "+(0,l.v_)(i.currentPage)+" 頁，共 "+(0,l.v_)(n.totalPages)+" 頁",1),(0,r.Lk)("button",{class:"btn btn-outline-secondary",disabled:1===i.currentPage,onClick:t[2]||(t[2]=e=>i.currentPage--)}," 上一頁 ",8,ir),(0,r.Lk)("button",{class:"btn btn-outline-secondary",disabled:i.currentPage===n.totalPages,onClick:t[3]||(t[3]=e=>i.currentPage++)}," 下一頁 ",8,nr)])]),(0,r.Lk)("table",lr,[t[21]||(t[21]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",{class:"text-nowrap text-center"},[(0,r.Lk)("th",null,"商品名稱"),(0,r.Lk)("th",null,"價格"),(0,r.Lk)("th",null,"庫存"),(0,r.Lk)("th",null,"描述"),(0,r.Lk)("th",null,"操作")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.paginatedProducts,((e,a)=>((0,r.uX)(),(0,r.CE)("tr",{key:e.id},[(0,r.Lk)("td",null,[(0,r.Lk)("div",cr,[(0,r.Lk)("p",dr,(0,l.v_)(e.name),1),e.name.length>20?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn btn-link btn-sm p-0",onClick:t=>n.toggleName(e)},(0,l.v_)(e.isNameExpanded?"收起":"查看更多"),9,ur)):(0,r.Q3)("",!0)])]),(0,r.Lk)("td",null,"NT$"+(0,l.v_)(Math.round(e.price)),1),(0,r.Lk)("td",pr,[(0,r.Lk)("span",{class:(0,l.C4)(e.stock<=10?"text-danger":"text-success")},(0,l.v_)(e.stock),3)]),(0,r.Lk)("td",null,[(0,r.Lk)("div",mr,[(0,r.Lk)("p",{class:(0,l.C4)(["product-description mb-1",{expanded:e.isDescriptionExpanded}]),style:{"max-width":"200px",overflow:"hidden","text-overflow":"ellipsis"}},(0,l.v_)(e.isDescriptionExpanded?e.description:e.description.slice(0,50)+"..."),3),e.description.length>50?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn btn-link btn-sm p-0",onClick:t=>n.toggleDescription(e)},(0,l.v_)(e.isDescriptionExpanded?"收起":"查看更多"),9,gr)):(0,r.Q3)("",!0)])]),(0,r.Lk)("td",hr,[(0,r.Lk)("div",kr,[(0,r.bF)(c,{to:{name:"EditProduct",params:{id:e.id}},class:"btn btn-warning btn-sm me-2"},{default:(0,r.k6)((()=>t[20]||(t[20]=[(0,r.eW)(" 編輯 ")]))),_:2},1032,["to"]),(0,r.Lk)("button",{class:"btn btn-danger btn-sm",onClick:t=>n.deleteProduct(e.id,a)}," 刪除 ",8,br)])])])))),128))])])])],2)])])):(0,r.Q3)("",!0),(0,r.Lk)("div",fr,[(0,r.Lk)("div",vr,[(0,r.Lk)("div",Lr,[(0,r.Lk)("div",yr,[(0,r.Lk)("h2",wr,[(0,r.Lk)("button",{class:"accordion-button",type:"button",onClick:t[4]||(t[4]=e=>n.toggleSection("tags"))}," 標籤管理 ")]),(0,r.Lk)("div",{class:(0,l.C4)(["accordion-collapse collapse",{show:i.isSectionOpen.tags}]),"aria-labelledby":"headingTags","data-bs-parent":"#tagAccordion"},[(0,r.Lk)("div",Cr,[(0,r.Lk)("div",Ir,[(0,r.Lk)("button",{class:"btn btn-success",onClick:t[5]||(t[5]=(...e)=>n.openCreateTagModal&&n.openCreateTagModal(...e))},"新增標籤")]),(0,r.Lk)("table",_r,[t[22]||(t[22]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"標籤名稱"),(0,r.Lk)("th",null,"操作")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.tags,((e,t)=>((0,r.uX)(),(0,r.CE)("tr",{key:e.id},[(0,r.Lk)("td",null,(0,l.v_)(e.name),1),(0,r.Lk)("td",null,[(0,r.Lk)("button",{class:"btn btn-warning btn-sm",onClick:e=>n.openEditTagModal(t)},"編輯",8,Pr),(0,r.Lk)("button",{class:"btn btn-danger btn-sm ml-2",onClick:a=>n.deleteTag(e.id,t)},"刪除",8,Ar)])])))),128))])])])],2)])])]),(0,r.Lk)("div",Er,[(0,r.Lk)("div",Fr,[(0,r.Lk)("div",Sr,[(0,r.Lk)("h2",Or,[(0,r.Lk)("button",{class:"accordion-button",type:"button",onClick:t[6]||(t[6]=e=>n.toggleSection("brands"))}," 廠牌管理 ")]),(0,r.Lk)("div",{class:(0,l.C4)(["accordion-collapse collapse",{show:i.isSectionOpen.brands}]),"aria-labelledby":"headingBrands","data-bs-parent":"#brandAccordion"},[(0,r.Lk)("div",xr,[(0,r.Lk)("div",Tr,[(0,r.Lk)("button",{class:"btn btn-success",onClick:t[7]||(t[7]=(...e)=>n.openCreateBrandModal&&n.openCreateBrandModal(...e))}," 新增廠牌 ")]),(0,r.Lk)("table",Ur,[t[23]||(t[23]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"廠牌名稱"),(0,r.Lk)("th",null,"操作")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.brands,((e,t)=>((0,r.uX)(),(0,r.CE)("tr",{key:e.id},[(0,r.Lk)("td",null,(0,l.v_)(e.name),1),(0,r.Lk)("td",null,[(0,r.Lk)("button",{class:"btn btn-warning btn-sm",onClick:e=>n.openEditBrandModal(t)},"編輯",8,Dr),(0,r.Lk)("button",{class:"btn btn-danger btn-sm ml-2",onClick:a=>n.deleteBrand(e.id,t)},"刪除",8,Nr)])])))),128))])])])],2)])])])])]),(0,r.Lk)("div",Rr,[(0,r.Lk)("div",$r,[(0,r.Lk)("div",Mr,[(0,r.Lk)("div",Xr,[t[25]||(t[25]=(0,r.Lk)("h5",{class:"modal-title"},"編輯標籤",-1)),(0,r.Lk)("button",{type:"button",class:"btn-close",onClick:t[8]||(t[8]=(...e)=>n.closeTagModal&&n.closeTagModal(...e))})]),(0,r.Lk)("div",qr,[(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=e=>i.tagForm.name=e),class:"form-control",placeholder:"標籤名稱"},null,512),[[s.Jo,i.tagForm.name]])]),(0,r.Lk)("div",Wr,[(0,r.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=(...e)=>n.closeTagModal&&n.closeTagModal(...e))},"取消"),(0,r.Lk)("button",{type:"submit",class:"btn btn-primary",onClick:t[11]||(t[11]=(...e)=>n.saveTag&&n.saveTag(...e))},(0,l.v_)(i.isEditingTag?"保存變更":"新增標籤"),1)])])])],512),(0,r.Lk)("div",Br,[(0,r.Lk)("div",Vr,[(0,r.Lk)("div",Kr,[(0,r.Lk)("div",jr,[t[26]||(t[26]=(0,r.Lk)("h5",{class:"modal-title"},"編輯廠牌",-1)),(0,r.Lk)("button",{type:"button",class:"btn-close",onClick:t[12]||(t[12]=(...e)=>n.closeBrandModal&&n.closeBrandModal(...e))})]),(0,r.Lk)("div",Qr,[(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>i.brandForm.name=e),class:"form-control",placeholder:"廠牌名稱"},null,512),[[s.Jo,i.brandForm.name]])]),(0,r.Lk)("div",Jr,[(0,r.Lk)("button",{class:"btn btn-secondary",onClick:t[14]||(t[14]=(...e)=>n.closeBrandModal&&n.closeBrandModal(...e))},"取消"),(0,r.Lk)("button",{class:"btn btn-primary",onClick:t[15]||(t[15]=(...e)=>n.saveBrand&&n.saveBrand(...e))},"保存")])])])],512)],64)}var Hr={name:"AdminProducts",data(){return{products:[],tags:[],brands:[],productForm:{name:"",price:0,stock:0,description:"",brand_id:"",tag_ids:[]},tagForm:{name:""},brandForm:{name:""},isEditing:!1,currentIndex:null,isEditingTag:!1,isEditingBrand:!1,currentPage:1,itemsPerPage:10,itemsPerPageOptions:[10,20,50],isSectionOpen:{products:!0,tags:!1,brands:!1}}},mounted(){this.loadProducts(),this.loadTags(),this.loadBrands()},computed:{paginatedProducts(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.products.slice(e,t)},totalPages(){return Math.ceil(this.products.length/this.itemsPerPage)}},methods:{toggleSection(e){this.isSectionOpen[e]=!this.isSectionOpen[e]},async loadProducts(){try{const e=await ne.A.productAPI.getAllProducts();console.log(e),this.products=e.map((e=>({...e,isDescriptionExanded:!1}))),this.currentPage>this.totalPages&&(this.currentPage=this.totalPages||1)}catch(e){Kt(e,"加載產品時出錯，請稍後再試！")}},async loadTags(){try{const e=await ne.A.tagAPI.getAllTags();this.tags=e}catch(e){Kt(e,"加載標籤時錯誤，請稍候再試！")}},async loadBrands(){try{const e=await ne.A.brandAPI.getAllBrands();this.brands=e}catch(e){Kt(e,"加載廠牌時出錯，請稍候再試！")}},async saveTag(){try{if(this.isEditingTag)await ne.A.tagAPI.updateTag(this.tagForm.id,this.tagForm),this.tags[this.currentIndex]={...this.tagForm};else{const e=await ne.A.tagAPI.createTag(this.tagForm);this.tags.push(e.data)}}catch(e){Kt(e,"保存標籤時出錯，請稍候再試！")}this.closeTagModal()},async saveBrand(){try{if(this.isEditingBrand)await ne.A.brandAPI.updateBrand(this.brandForm.id,this.brandForm),this.brands[this.currentIndex]={...this.brandForm};else{const e=await ne.A.brandAPI.createBrand(this.brandForm);this.brands.push(e.data)}}catch(e){Kt(e,"保存廠牌時出錯，請稍候再試！")}this.closeBrandModal()},async deleteProduct(e,t){if(confirm("確定要刪除此商品？"))try{await ne.A.productAPI.deleteProduct(e),this.products.splice(t,1)}catch(a){Kt(a,"刪除產品時出錯，請稍後再試！")}},async deleteTag(e,t){if(confirm("確定要刪除此標籤？"))try{await ne.A.tagAPI.deleteTag(e),this.tags.splice(t,1)}catch(a){Kt(a,"刪除標籤時出錯，請稍後再試！")}},async deleteBrand(e,t){if(confirm("確定要刪除此廠牌？"))try{await ne.A.brandAPI.deleteBrand(e),this.brands.splice(t,1)}catch(a){Kt(a,"刪除廠牌時出錯，請稍後再試！")}},openCreateTagModal(){this.isEditingTag=!1,this.tagForm={name:""},this.$nextTick((()=>{const e=new K.aF(this.$refs.tagModal);e.show()}))},openCreateBrandModal(){this.isEditingBrand=!1,this.brandForm={name:""},this.$nextTick((()=>{const e=new K.aF(this.$refs.brandModal);e.show()}))},openEditTagModal(e){this.isEditingTag=!0,this.currentIndex=e,this.tagForm={...this.tags[e]};const t=new K.aF(this.$refs.tagModal);t.show()},openEditBrandModal(e){this.isEditingBrand=!0,this.currentIndex=e,this.brandForm={...this.brands[e]};const t=new K.aF(this.$refs.brandModal);t.show()},closeTagModal(){const e=K.aF.getInstance(this.$refs.tagModal);e&&e.hide()},closeBrandModal(){const e=K.aF.getInstance(this.$refs.brandModal);e&&e.hide()},toggleDescription(e){e.isDescriptionExpanded=!e.isDescriptionExpanded},toggleName(e){e.isNameExpanded=!e.isNameExpanded}},watch:{itemsPerPage(){this.currentPage=1}}};const Gr=(0,I.A)(Hr,[["render",zr],["__scopeId","data-v-f2c81672"]]);var Zr=Gr;const Yr={class:"admin-dashboard container py-4"},eo={class:"page-header mb-4"},to={class:"d-flex justify-content-between align-items-center"},ao={class:"card shadow-sm"},so={class:"table-responsive"},ro={class:"table table-hover align-middle mb-0"},oo={class:"d-flex align-items-center"},io={class:"user-avatar me-3"},no={class:"mb-0"},lo={class:"text-muted"},co=["onClick"],uo={key:1,class:"text-muted"},po={class:"text-end"},mo={class:"btn-group"},go=["onClick"],ho=["onClick"],ko={key:0},bo={colspan:"4",class:"bg-light"},fo={class:"recipient-list p-3"},vo={class:"recipient-info"},Lo={class:"mb-2"},yo={class:"mb-1"},wo={class:"mb-0"},Co={class:"recipient-actions"},Io=["onClick"],_o=["onClick"],Po={class:"modal fade",tabindex:"-1",ref:"userModal"},Ao={class:"modal-dialog"},Eo={class:"modal-content"},Fo={class:"modal-header border-0"},So={class:"modal-title"},Oo={class:"modal-body"},xo={class:"mb-3"},To={class:"mb-3"},Uo={class:"mb-3"},Do={class:"input-group"},No=["type","required"],Ro={class:"mb-3"},$o=["required"],Mo={class:"mb-3"},Xo={key:0},qo={class:"mb-3"},Wo={class:"mb-3"},Bo={class:"modal-footer border-0"};function Vo(e,t,a,o,i,n){return(0,r.uX)(),(0,r.CE)("div",Yr,[(0,r.Lk)("div",eo,[(0,r.Lk)("div",to,[t[14]||(t[14]=(0,r.Lk)("div",null,[(0,r.Lk)("h2",{class:"fw-bold text-primary mb-1"},"用戶管理"),(0,r.Lk)("p",{class:"text-muted mb-0"},"管理系統用戶和權限")],-1)),(0,r.Lk)("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...e)=>n.openCreateUserModal&&n.openCreateUserModal(...e))},t[13]||(t[13]=[(0,r.Lk)("i",{class:"fas fa-user-plus me-2"},null,-1),(0,r.eW)("新增用戶 ")]))])]),(0,r.Lk)("div",ao,[(0,r.Lk)("div",so,[(0,r.Lk)("table",ro,[t[21]||(t[21]=(0,r.Lk)("thead",{class:"bg-light"},[(0,r.Lk)("tr",null,[(0,r.Lk)("th",{class:"py-3"},"用戶資訊"),(0,r.Lk)("th",{class:"py-3"},"權限"),(0,r.Lk)("th",{class:"py-3"},"收件地址"),(0,r.Lk)("th",{class:"py-3 text-end"},"操作")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.users,((a,s)=>((0,r.uX)(),(0,r.CE)(r.FK,{key:s},[(0,r.Lk)("tr",null,[(0,r.Lk)("td",null,[(0,r.Lk)("div",oo,[(0,r.Lk)("div",io,(0,l.v_)(n.getUserInitials(a.name)),1),(0,r.Lk)("div",null,[(0,r.Lk)("h6",no,(0,l.v_)(a.name),1),(0,r.Lk)("small",lo,(0,l.v_)(a.email),1)])])]),(0,r.Lk)("td",null,[(0,r.Lk)("span",{class:(0,l.C4)(n.getRoleBadgeClass(a.role))},(0,l.v_)(n.getRoleDisplayName(a.role)),3)]),(0,r.Lk)("td",null,[a.recipients&&a.recipients.length?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn btn-link btn-sm text-decoration-none",onClick:e=>n.toggleRecipients(s)},[(0,r.eW)((0,l.v_)(a.recipients.length)+" 個地址 ",1),(0,r.Lk)("i",{class:(0,l.C4)(["fas",a.showRecipients?"fa-chevron-up":"fa-chevron-down","ms-1"])},null,2)],8,co)):((0,r.uX)(),(0,r.CE)("span",uo,"無收件地址"))]),(0,r.Lk)("td",po,[(0,r.Lk)("div",mo,[(0,r.Lk)("button",{class:"btn btn-outline-primary btn-sm",onClick:e=>n.openEditUserModal(s),title:"編輯用戶"},t[15]||(t[15]=[(0,r.Lk)("i",{class:"fas fa-edit"},null,-1)]),8,go),(0,r.Lk)("button",{class:"btn btn-outline-danger btn-sm",onClick:e=>n.deleteUser(s),title:"刪除用戶"},t[16]||(t[16]=[(0,r.Lk)("i",{class:"fas fa-trash"},null,-1)]),8,ho)])])]),a.showRecipients&&a.recipients&&a.recipients.length?((0,r.uX)(),(0,r.CE)("tr",ko,[(0,r.Lk)("td",bo,[(0,r.Lk)("div",fo,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.recipients,((a,o)=>((0,r.uX)(),(0,r.CE)("div",{key:o,class:"recipient-item"},[(0,r.Lk)("div",vo,[(0,r.Lk)("h6",Lo,(0,l.v_)(a.name),1),(0,r.Lk)("p",yo,[t[17]||(t[17]=(0,r.Lk)("i",{class:"fas fa-phone me-2 text-muted"},null,-1)),(0,r.eW)(" "+(0,l.v_)(a.phone),1)]),(0,r.Lk)("p",wo,[t[18]||(t[18]=(0,r.Lk)("i",{class:"fas fa-map-marker-alt me-2 text-muted"},null,-1)),(0,r.eW)(" "+(0,l.v_)(a.address),1)])]),(0,r.Lk)("div",Co,[(0,r.Lk)("button",{class:"btn btn-outline-primary btn-sm me-2",onClick:t=>e.editRecipient(s,o)},t[19]||(t[19]=[(0,r.Lk)("i",{class:"fas fa-edit"},null,-1)]),8,Io),(0,r.Lk)("button",{class:"btn btn-outline-danger btn-sm",onClick:t=>e.deleteRecipient(s,o)},t[20]||(t[20]=[(0,r.Lk)("i",{class:"fas fa-trash"},null,-1)]),8,_o)])])))),128))])])])):(0,r.Q3)("",!0)],64)))),128))])])])]),(0,r.Lk)("div",Po,[(0,r.Lk)("div",Ao,[(0,r.Lk)("div",Eo,[(0,r.Lk)("div",Fo,[(0,r.Lk)("h5",So,(0,l.v_)(i.isEditing?"編輯用戶":"新增用戶"),1),(0,r.Lk)("button",{type:"button",class:"btn-close",onClick:t[1]||(t[1]=(...e)=>n.closeModal&&n.closeModal(...e))})]),(0,r.Lk)("div",Oo,[(0,r.Lk)("form",{onSubmit:t[10]||(t[10]=(0,s.D$)(((...e)=>n.saveUser&&n.saveUser(...e)),["prevent"])),class:"needs-validation"},[(0,r.Lk)("div",xo,[t[22]||(t[22]=(0,r.Lk)("label",{class:"form-label"},"用戶名稱",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=e=>i.userForm.name=e),required:""},null,512),[[s.Jo,i.userForm.name]])]),(0,r.Lk)("div",To,[t[23]||(t[23]=(0,r.Lk)("label",{class:"form-label"},"電子郵件",-1)),(0,r.bo)((0,r.Lk)("input",{type:"email",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=e=>i.userForm.email=e),required:""},null,512),[[s.Jo,i.userForm.email]])]),(0,r.Lk)("div",Uo,[t[24]||(t[24]=(0,r.Lk)("label",{class:"form-label"},"密碼",-1)),(0,r.Lk)("div",Do,[(0,r.bo)((0,r.Lk)("input",{type:i.showPassword?"text":"password",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=e=>i.userForm.password=e),required:!i.isEditing},null,8,No),[[s.hp,i.userForm.password]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[5]||(t[5]=e=>i.showPassword=!i.showPassword)},[(0,r.Lk)("i",{class:(0,l.C4)(["fas",i.showPassword?"fa-eye-slash":"fa-eye"])},null,2)])])]),(0,r.Lk)("div",Ro,[t[25]||(t[25]=(0,r.Lk)("label",{class:"form-label"},"確認密碼",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",class:"form-control","onUpdate:modelValue":t[6]||(t[6]=e=>i.userForm.confirmPassword=e),required:!i.isEditing||i.userForm.password},null,8,$o),[[s.Jo,i.userForm.confirmPassword]])]),(0,r.Lk)("div",Mo,[t[27]||(t[27]=(0,r.Lk)("label",{class:"form-label"},"用戶權限",-1)),(0,r.bo)((0,r.Lk)("select",{class:"form-select","onUpdate:modelValue":t[7]||(t[7]=e=>i.userForm.role=e)},t[26]||(t[26]=[(0,r.Lk)("option",{value:"user"},"一般用戶",-1),(0,r.Lk)("option",{value:"admin"},"管理員",-1)]),512),[[s.u1,i.userForm.role]])]),"user"===i.userForm.role?((0,r.uX)(),(0,r.CE)("div",Xo,[(0,r.Lk)("div",qo,[t[28]||(t[28]=(0,r.Lk)("label",{class:"form-label"},"聯絡電話",-1)),(0,r.bo)((0,r.Lk)("input",{type:"tel",class:"form-control","onUpdate:modelValue":t[8]||(t[8]=e=>i.userForm.phone=e),required:""},null,512),[[s.Jo,i.userForm.phone]])]),(0,r.Lk)("div",Wo,[t[29]||(t[29]=(0,r.Lk)("label",{class:"form-label"},"聯絡地址",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[9]||(t[9]=e=>i.userForm.address=e),required:""},null,512),[[s.Jo,i.userForm.address]])])])):(0,r.Q3)("",!0)],32)]),(0,r.Lk)("div",Bo,[(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[11]||(t[11]=(...e)=>n.closeModal&&n.closeModal(...e))},"取消"),(0,r.Lk)("button",{type:"submit",class:"btn btn-primary",onClick:t[12]||(t[12]=(...e)=>n.saveUser&&n.saveUser(...e))},(0,l.v_)(i.isEditing?"保存變更":"新增用戶"),1)])])])],512)])}var Ko={name:"AdminUsers",data(){return{users:[],userForm:{name:"",email:"",password:"",confirmPassword:"",role:"user",phone:"",address:""},isEditing:!1,currentIndex:null,showPassword:!1}},mounted(){this.loadUsers()},methods:{async loadUsers(){try{const e=await ne.A.userAPI.getAllUsers();this.users=e.data}catch(e){Kt(e,"無法加載用戶資料")}},openCreateUserModal(){this.isEditing=!1,this.userForm={name:"",email:"",password:"",confirmPassword:"",role:"user",phone:"",address:""},this.$nextTick((()=>{const e=new K.aF(this.$refs.userModal);e.show()}))},openEditUserModal(e){this.isEditing=!0,this.currentIndex=e,this.userForm={...this.users[e]},this.userForm.password="",this.userForm.confirmPassword="";const t=new K.aF(this.$refs.userModal);t.show()},async saveUser(){try{if(this.userForm.password!==this.userForm.confirmPassword)return void alert("密碼和確認密碼不一致");if(this.isEditing){const e={name:this.userForm.name,email:this.userForm.email,role:this.userForm.role,phone:this.userForm.phone,address:this.userForm.address};this.userForm.password&&(e.password=this.userForm.password),await ne.A.userAPI.updateUser(this.userForm.id,e),this.users[this.currentIndex]={...this.userForm}}else{const e={name:this.userForm.name,email:this.userForm.email,role:this.userForm.role,phone:this.userForm.phone,address:this.userForm.address,password:this.userForm.password},t=await ne.A.userAPI.createUsers(e);this.users.push(t.data)}this.closeModal()}catch(e){console.error("更新用戶資料時錯誤！",e),alert("更新用戶資料失敗！")}},async deleteUser(e){if(confirm("確定要刪除此用戶嗎？"))try{await ne.A.userAPI.deleteUsers(this.users[e].id),this.users.splice(e,1)}catch(t){alert("無法刪除用戶")}},closeModal(){this.$nextTick((()=>{const e=K.aF.getInstance(this.$refs.userModal);e&&e.hide()}))},getUserInitials(e){return e?e.substring(0,2).toUpperCase():"??"},getRoleBadgeClass(e){return"admin"===e?"badge bg-primary":"badge bg-success"},getRoleDisplayName(e){return"admin"===e?"管理員":"一般用戶"},toggleRecipients(e){this.$set(this.users[e],"showRecipients",!this.users[e].showRecipients)}}};const jo=(0,I.A)(Ko,[["render",Vo],["__scopeId","data-v-c4ddb490"]]);var Qo=jo;const Jo={class:"admin-dashboard container mt-5"},zo={class:"filters-container p-3 bg-light rounded-3 mb-4"},Ho={class:"row g-3"},Go={class:"col-md-5"},Zo={class:"input-group"},Yo={class:"col-md-4"},ei={class:"col-md-3"},ti={class:"table-responsive rounded-3 shadow-sm"},ai={class:"table table-hover mb-0"},si={class:"align-middle"},ri={class:"align-middle"},oi={class:"d-flex align-items-center"},ii={class:"user-avatar"},ni={class:"ms-2"},li={class:"align-middle fw-bold"},ci={class:"align-middle"},di={class:"align-middle"},ui={class:"align-middle"},pi=["onClick"],mi=["onClick","disabled"],gi={class:"pagination-container mt-4 d-flex justify-content-between align-items-center"},hi={class:"page-info text-muted"},ki={class:"pagination-controls"},bi=["disabled"],fi=["disabled"];function vi(e,t,a,o,i,n){const c=(0,r.gN)("tooltip");return(0,r.uX)(),(0,r.CE)("div",Jo,[t[13]||(t[13]=(0,r.Lk)("div",{class:"dashboard-header mb-4"},[(0,r.Lk)("h2",{class:"text-primary fw-bold"},"訂單管理系統"),(0,r.Lk)("p",{class:"text-muted"},"管理所有訂單狀態與詳情")],-1)),(0,r.Lk)("div",zo,[(0,r.Lk)("div",Ho,[(0,r.Lk)("div",Go,[(0,r.Lk)("div",Zo,[t[5]||(t[5]=(0,r.Lk)("span",{class:"input-group-text bg-white"},[(0,r.Lk)("i",{class:"fas fa-search text-muted"})],-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control border-start-0",placeholder:"搜尋訂單號或用戶名","onUpdate:modelValue":t[0]||(t[0]=e=>i.searchQuery=e)},null,512),[[s.Jo,i.searchQuery]])])]),(0,r.Lk)("div",Yo,[(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.selectedStatus=e),class:"form-select"},t[6]||(t[6]=[(0,r.Fv)('<option value="" data-v-50128844>所有訂單狀態</option><option value="pending" data-v-50128844>待確認</option><option value="shipped" data-v-50128844>已發貨</option><option value="completed" data-v-50128844>已完成</option><option value="cancelled" data-v-50128844>已取消</option>',5)]),512),[[s.u1,i.selectedStatus]])]),(0,r.Lk)("div",ei,[(0,r.Lk)("button",{class:"btn btn-primary w-100",onClick:t[2]||(t[2]=(...e)=>n.filterOrders&&n.filterOrders(...e))},t[7]||(t[7]=[(0,r.Lk)("i",{class:"fas fa-filter me-2"},null,-1),(0,r.eW)("套用篩選 ")]))])])]),(0,r.Lk)("div",ti,[(0,r.Lk)("table",ai,[t[10]||(t[10]=(0,r.Lk)("thead",{class:"bg-light"},[(0,r.Lk)("tr",null,[(0,r.Lk)("th",{class:"py-3"},"訂單號"),(0,r.Lk)("th",{class:"py-3"},"用戶資訊"),(0,r.Lk)("th",{class:"py-3"},"總金額"),(0,r.Lk)("th",{class:"py-3"},"狀態"),(0,r.Lk)("th",{class:"py-3"},"建立日期"),(0,r.Lk)("th",{class:"py-3"},"操作")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.paginatedOrders,(e=>((0,r.uX)(),(0,r.CE)("tr",{key:e.id},[(0,r.Lk)("td",si,"#"+(0,l.v_)(e.id),1),(0,r.Lk)("td",ri,[(0,r.Lk)("div",oi,[(0,r.Lk)("span",ii,(0,l.v_)(n.getUserInitials(e.user_id)),1),(0,r.Lk)("span",ni,(0,l.v_)(n.getUserName(e.user_id)),1)])]),(0,r.Lk)("td",li,(0,l.v_)(n.formatCurrency(e.total)),1),(0,r.Lk)("td",ci,[(0,r.Lk)("span",{class:(0,l.C4)(n.getStatusBadgeClass(e.status))},(0,l.v_)(n.formatStatus(e.status)),3)]),(0,r.Lk)("td",di,(0,l.v_)(n.formatDate(e.order_date)),1),(0,r.Lk)("td",ui,[(0,r.Lk)("button",{class:"btn btn-outline-info btn-sm me-2",onClick:t=>n.viewOrderDetails(e)},t[8]||(t[8]=[(0,r.Lk)("i",{class:"fas fa-eye me-1"},null,-1),(0,r.eW)("查看 ")]),8,pi),(0,r.bo)(((0,r.uX)(),(0,r.CE)("button",{class:"btn btn-outline-danger btn-sm",onClick:t=>n.cancelOrder(e),disabled:"cancelled"===e.status||"completed"===e.status},t[9]||(t[9]=[(0,r.Lk)("i",{class:"fas fa-times me-1"},null,-1),(0,r.eW)("取消 ")]),8,mi)),[[c,"cancelled"===e.status||"completed"===e.status?"無法取消已完成或已取消的訂單":"取消此訂單"]])])])))),128))])])]),(0,r.Lk)("div",gi,[(0,r.Lk)("div",hi," 顯示第 "+(0,l.v_)(n.paginationInfo.start)+" 到 "+(0,l.v_)(n.paginationInfo.end)+" 筆，共 "+(0,l.v_)(n.filteredOrders.length)+" 筆 ",1),(0,r.Lk)("div",ki,[(0,r.Lk)("button",{class:"btn btn-outline-primary me-2",onClick:t[3]||(t[3]=(...e)=>n.prevPage&&n.prevPage(...e)),disabled:1===i.currentPage},t[11]||(t[11]=[(0,r.Lk)("i",{class:"fas fa-chevron-left me-1"},null,-1),(0,r.eW)("上一頁 ")]),8,bi),(0,r.Lk)("button",{class:"btn btn-outline-primary",onClick:t[4]||(t[4]=(...e)=>n.nextPage&&n.nextPage(...e)),disabled:i.currentPage===n.totalPages},t[12]||(t[12]=[(0,r.eW)(" 下一頁"),(0,r.Lk)("i",{class:"fas fa-chevron-right ms-1"},null,-1)]),8,fi)])])])}a(2577);var Li=a(2952),yi=a.n(Li),wi={name:"AdminOrders",data(){return{orders:[],users:[],searchQuery:"",selectedStatus:"",currentPage:1,itemsPerPage:10,debouncedFilter:null,loading:!1,showToast:!1,toastMessage:"",toastType:"success"}},computed:{filteredOrders(){return this.orders.filter((e=>{const t=e.user_id&&e.user_id.toString().toLowerCase().includes(this.searchQuery.toLowerCase())||e.id&&e.id.toString().toLowerCase().includes(this.searchQuery.toLowerCase()),a=!this.selectedStatus||e.status===this.selectedStatus;return t&&a}))},totalPages(){return Math.ceil(this.filteredOrders.length/this.itemsPerPage)||1},paginatedOrders(){const e=(this.currentPage-1)*this.itemsPerPage,t=this.currentPage*this.itemsPerPage;return this.filteredOrders.slice(e,t)},paginationInfo(){const e=(this.currentPage-1)*this.itemsPerPage+1,t=Math.min(this.currentPage*this.itemsPerPage,this.filteredOrders.length);return{start:e,end:t}}},methods:{async fetchOrders(){try{const e=await ne.A.orderAPI.getOrders();console.log("API回傳的訂單資料",e.data);const t=e.data;this.orders=t.map((e=>({...e,status:e.status||"pending"})))||[]}catch(e){e.response&&401===e.response.status?(alert("您的登入已過期，請重新登入。"),this.$store.dispatch("auth/logout"),this.$router.push("/UserLogin")):e.response&&403===e.response.status?(alert("您沒有權限訪問此頁面"),this.$router.push("/")):(console.error("加載訂單時出錯",e),alert("加載訂單時出錯，請稍後再試")),this.orders=[]}},async fetchUsers(){try{const e=await ne.A.userAPI.getAllUsers();this.users=e.data||[]}catch(e){console.error("加載用戶時出錯",e),alert("加載用戶時出錯，請稍候再試！"),this.users=[]}},viewOrderDetails(e){console.log("查看訂單",e),this.$router.push({name:"OrderDetail",params:{id:e.id}})},async cancelOrder(e){if(confirm("確定要取消這個訂單？"))try{await ne.A.orderAPI.updateOrder(e.id,{status:"cancelled"}),e.status="cancelled",alert("訂單已成功取消。")}catch(t){console.error("取消訂單時出錯",t),alert("取消訂單時出錯")}},prevPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++},formatCurrency(e){return new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},formatStatus(e){const t={pending:"待確認",shipped:"已發貨",completed:"已完成",cancelled:"已取消"};return t[e]||"未知狀態"},formatDate(e){const t={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(e).toLocaleDateString("zh-TW",t)},filterOrders(){this.currentPage=1},getUserName(e){const t=this.users.find((t=>t.id==e));return t?t.name:"未知用戶"},getStatusBadgeClass(e){const t={pending:"badge bg-warning text-dark",shipped:"badge bg-info text-white",completed:"badge bg-success text-white",cancelled:"badge bg-danger text-white"};return t[e]||"badge bg-secondary"},getUserInitials(e){const t=this.users.find((t=>t.id===e));return t?t.name.substring(0,2).toUpperCase():"??"},showNotification(e,t="success"){this.toastMessage=e,this.toastType=t,this.showToast=!0,setTimeout((()=>{this.showToast=!1}),3e3)}},async mounted(){try{await this.fetchOrders(),await this.fetchUsers()}catch(e){console.error("獲取訂單或用戶數據時出錯",e),alert("獲取訂單或用戶數據時出錯，請稍後再試！")}},watch:{searchQuery(){this.debouncedFilter()},selectedStatus(){this.debouncedFilter()}}};const Ci=(0,I.A)(wi,[["render",vi],["__scopeId","data-v-50128844"]]);var Ii=Ci;const _i={class:"container mt-5"},Pi={class:"mb-3"},Ai={class:"mb-3"},Ei={class:"mb-3"},Fi={class:"mb-3"},Si={class:"mb-3"},Oi={key:0,class:"text-danger"},xi={class:"mb-3"},Ti={key:0,class:"text-danger"},Ui={class:"mb-3"},Di={key:0},Ni=["src"];function Ri(e,t,a,o,i,n){const l=(0,r.g2)("Multiselect");return(0,r.uX)(),(0,r.CE)("div",_i,[t[17]||(t[17]=(0,r.Lk)("h2",{class:"text-center mb-4"},"新增商品",-1)),(0,r.Lk)("form",{onSubmit:t[7]||(t[7]=(0,s.D$)(((...e)=>o.createProduct&&o.createProduct(...e)),["prevent"]))},[(0,r.Lk)("div",Pi,[t[8]||(t[8]=(0,r.Lk)("label",{for:"productName",class:"form-label"},"商品名稱",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>o.productForm.name=e),class:"form-control",required:""},null,512),[[s.Jo,o.productForm.name]])]),(0,r.Lk)("div",Ai,[t[9]||(t[9]=(0,r.Lk)("label",{for:"description",class:"form-label"},"商品描述",-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.productForm.description=e),class:"form-control",required:""},null,512),[[s.Jo,o.productForm.description]])]),(0,r.Lk)("div",Ei,[t[10]||(t[10]=(0,r.Lk)("label",{for:"price",class:"form-label"},"價格",-1)),(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=e=>o.productForm.price=e),class:"form-control",required:""},null,512),[[s.Jo,o.productForm.price]])]),(0,r.Lk)("div",Fi,[t[11]||(t[11]=(0,r.Lk)("label",{for:"stock",class:"form-label"},"庫存",-1)),(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=e=>o.productForm.stock=e),class:"form-control",required:""},null,512),[[s.Jo,o.productForm.stock]])]),(0,r.Lk)("div",Si,[t[12]||(t[12]=(0,r.Lk)("label",{for:"brand_id",class:"form-label"},"選擇品牌",-1)),(0,r.bF)(l,{modelValue:o.productForm.brand_id,"onUpdate:modelValue":t[4]||(t[4]=e=>o.productForm.brand_id=e),options:o.brands,searchable:!0,taggable:!0,label:"name",key:"id",valueProp:"id",placeholder:"搜尋或選擇品牌",onSelect:o.handleBrandSelect,onTag:o.createNewBrand},null,8,["modelValue","options","onSelect","onTag"]),!o.productForm.brand_id&&o.formSubmitted?((0,r.uX)(),(0,r.CE)("span",Oi,"請選擇品牌")):(0,r.Q3)("",!0)]),(0,r.Lk)("div",xi,[t[13]||(t[13]=(0,r.Lk)("label",{for:"tag_ids",class:"form-label"},"選擇標籤",-1)),(0,r.bF)(l,{modelValue:o.productForm.tag_ids,"onUpdate:modelValue":t[5]||(t[5]=e=>o.productForm.tag_ids=e),options:o.tags,searchable:!0,taggable:!0,label:"name",multiple:!0,key:"id",valueProp:"id",placeholder:"搜尋或選擇標籤",onSelect:o.handleTagSelect,onTag:o.createNewTag},null,8,["modelValue","options","onSelect","onTag"]),!o.productForm.tag_ids?.length&&o.formSubmitted?((0,r.uX)(),(0,r.CE)("span",Ti,"請選擇至少一個標籤")):(0,r.Q3)("",!0)]),(0,r.Lk)("div",Ui,[t[14]||(t[14]=(0,r.Lk)("label",{for:"productImage",class:"form-label"},"圖片上傳",-1)),(0,r.Lk)("input",{type:"file",class:"form-control",id:"productImage",onChange:t[6]||(t[6]=(...e)=>o.selectImage&&o.selectImage(...e)),accept:"image/*"},null,32)]),o.productForm.imagePreview?((0,r.uX)(),(0,r.CE)("div",Di,[t[15]||(t[15]=(0,r.Lk)("h5",null,"圖片預覽",-1)),(0,r.Lk)("img",{src:o.productForm.imagePreview,alt:"商品圖片",style:{"max-width":"200px"}},null,8,Ni)])):(0,r.Q3)("",!0),t[16]||(t[16]=(0,r.Lk)("button",{type:"submit",class:"btn btn-primary"},"新增商品",-1))],32)])}a(4603),a(7566),a(8721);var $i=a(8074),Mi={name:"CreateProduct",components:{Multiselect:$i.Ay},setup(){const e=(0,Q.rd)(),t=(0,we.Kh)({name:"",description:"",price:0,stock:0,brand_id:null,tag_ids:[],created_at:(new Date).toISOString().split("T")[0],imageFile:null,imagePreview:""}),a=()=>t.name.trim()?t.description.trim()?t.price<=0?(alert("價格必填且需大於 0"),!1):t.stock<=0?(alert("庫存必填且需大於 0"),!1):t.brand_id?!!t.tag_ids.length||(alert("請選擇至少一個標籤"),!1):(alert("請選擇品牌"),!1):(alert("商品描述必填"),!1):(alert("商品名稱必填"),!1),s=(0,we.KR)([]),o=(0,we.KR)([]),i=(0,we.KR)(!1),n=async()=>{try{const e=await ne.A.brandAPI.getAllBrands();s.value=Array.isArray(e.data)?e.data:[],console.log("加載的品牌資料:",s.value)}catch(e){Kt(e,"讀取品牌資料時出錯，請稍後再試！")}},l=async()=>{try{const e=await ne.A.tagAPI.getAllTags();o.value=Array.isArray(e.data)?e.data:[],console.log("加載的標籤資料:",o.value)}catch(e){Kt(e,"讀取標籤資料時出錯，請稍後再試！")}},c=e=>{t.brand_id=e,console.log("選擇的品牌:",e)},d=e=>{Array.isArray(e)?t.tag_ids=e:t.tag_ids=[e].filter(Boolean),console.log("選擇的標籤",e)},u=async e=>{try{const a=await ne.A.brandAPI.createBrand(e),r=a.data;s.value.push(r),t.brand_id=r.id,alert("新品牌已添加")}catch(a){Kt(a,"創建新品牌時出錯，請稍後再試！")}},p=async e=>{try{const a=await ne.A.tagAPI.createTag(e),s=a.data;o.value.push(s),t.tag_ids.push(s.id),alert("新標籤已增加")}catch(a){Kt(a,"創建新標籤時出錯，請稍後再試！")}};(0,r.sV)((()=>{n(),l()}));const m=async()=>{if(i.value=!0,a())if(t.brand_id&&t.tag_ids&&0!==t.tag_ids.length)try{const a=new FormData;let s=[];Array.isArray(t.tag_ids)&&(s=t.tag_ids.map((e=>"object"===typeof e?e.id:e))),a.append("name",t.name),a.append("description",t.description),a.append("price",String(t.price)),a.append("stock",String(t.stock)),a.append("brand_id","object"===typeof t.brand_id?t.brand_id.id:t.brand_id),a.append("tag_ids",JSON.stringify(s)),a.append("created_at",t.created_at),t.imageFile&&a.append("image",t.imageFile);const r=await ne.A.productAPI.createProduct(a);console.log("伺服器回應：",r.data),alert("商品新增成功"),e.push("/admin/products")}catch(s){Kt(s,"新增商品時出錯，請稍後再試！")}finally{i.value=!1}else alert("請選擇品牌和至少一個標籤")},g=e=>{const a=e.target.files[0];if(a&&!a.type.startsWith("image/"))return alert("請上傳正確的圖片格式"),void(e.target.value="");t.imageFile=a,t.imagePreview=URL.createObjectURL(a)};return{productForm:t,brands:s,tags:o,formSubmitted:i,createProduct:m,selectImage:g,handleBrandSelect:c,handleTagSelect:d,validateForm:a,createNewBrand:u,createNewTag:p}}};const Xi=(0,I.A)(Mi,[["render",Ri],["__scopeId","data-v-7a4cf5ca"]]);var qi=Xi;const Wi={class:"container mt-5"},Bi={key:0,class:"text-center my-5"},Vi={key:0,class:"text-center mb-4"},Ki=["src"],ji={class:"mb-3"},Qi={class:"mb-3"},Ji={class:"input-group"},zi=["readonly"],Hi={class:"mb-3"},Gi={class:"input-group"},Zi=["readonly"],Yi={class:"mb-3"},en={class:"input-group"},tn=["readonly"],an={class:"mb-3"},sn={class:"input-group"},rn=["readonly"],on={class:"mb-3"},nn={class:"input-group"},ln={class:"mb-3"},cn={class:"input-group"},dn={class:"custom-tag"},un=["onClick"];function pn(e,t,a,o,i,n){const c=(0,r.g2)("Multiselect");return(0,r.uX)(),(0,r.CE)("div",Wi,[t[23]||(t[23]=(0,r.Lk)("h2",{class:"text-center"},"編輯產品資訊",-1)),o.isLoading?((0,r.uX)(),(0,r.CE)("div",Bi,t[14]||(t[14]=[(0,r.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,r.Lk)("span",{class:"visually-hidden"},"載入中...")],-1)]))):(0,r.Q3)("",!0),o.isLoading?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("form",{key:1,onSubmit:t[13]||(t[13]=(0,s.D$)(((...e)=>o.updateProduct&&o.updateProduct(...e)),["prevent"]))},[o.productForm.imagePreview?((0,r.uX)(),(0,r.CE)("div",Vi,[(0,r.Lk)("img",{src:o.productForm.imagePreview,alt:"Product Image",class:"product-image"},null,8,Ki)])):(0,r.Q3)("",!0),(0,r.Lk)("div",ji,[t[15]||(t[15]=(0,r.Lk)("label",{for:"productImage",class:"form-label"},"產品圖片",-1)),(0,r.Lk)("input",{type:"file",id:"productImage",class:"form-control",onChange:t[0]||(t[0]=(...e)=>o.selectImage&&o.selectImage(...e))},null,32)]),(0,r.Lk)("div",Qi,[t[16]||(t[16]=(0,r.Lk)("label",{for:"productName",class:"form-label"},"商品名稱",-1)),(0,r.Lk)("div",Ji,[(0,r.bo)((0,r.Lk)("input",{type:"text",id:"productName",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=e=>o.productForm.name=e),readonly:!o.editableFields.name,required:""},null,8,zi),[[s.Jo,o.productForm.name]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[2]||(t[2]=e=>o.toggleEdit("name"))},(0,l.v_)(o.editableFields.name?"完成":"修改"),1)])]),(0,r.Lk)("div",Hi,[t[17]||(t[17]=(0,r.Lk)("label",{for:"productPrice",class:"form-label"},"價格",-1)),(0,r.Lk)("div",Gi,[(0,r.bo)((0,r.Lk)("input",{type:"number",id:"productPrice",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=e=>o.productForm.price=e),readonly:!o.editableFields.price,required:""},null,8,Zi),[[s.Jo,o.productForm.price]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[4]||(t[4]=e=>o.toggleEdit("price"))},(0,l.v_)(o.editableFields.price?"完成":"修改"),1)])]),(0,r.Lk)("div",Yi,[t[18]||(t[18]=(0,r.Lk)("label",{for:"productStock",class:"form-label"},"庫存",-1)),(0,r.Lk)("div",en,[(0,r.bo)((0,r.Lk)("input",{type:"number",id:"productStock",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=e=>o.productForm.stock=e),readonly:!o.editableFields.stock,required:""},null,8,tn),[[s.Jo,o.productForm.stock]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[6]||(t[6]=e=>o.toggleEdit("stock"))},(0,l.v_)(o.editableFields.stock?"完成":"修改"),1)])]),(0,r.Lk)("div",an,[t[19]||(t[19]=(0,r.Lk)("label",{for:"productDescription",class:"form-label"},"描述",-1)),(0,r.Lk)("div",sn,[(0,r.bo)((0,r.Lk)("textarea",{type:"number",id:"productDescription",class:"form-control","onUpdate:modelValue":t[7]||(t[7]=e=>o.productForm.description=e),readonly:!o.editableFields.description,required:""},null,8,rn),[[s.Jo,o.productForm.description]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[8]||(t[8]=e=>o.toggleEdit("description"))},(0,l.v_)(o.editableFields.description?"完成":"修改"),1)])]),(0,r.Lk)("div",on,[t[20]||(t[20]=(0,r.Lk)("label",{for:"productBrand",class:"form-label"},"廠牌",-1)),(0,r.Lk)("div",nn,[(0,r.bF)(c,{modelValue:o.productForm.brand_id,"onUpdate:modelValue":t[9]||(t[9]=e=>o.productForm.brand_id=e),options:o.brands,searchable:!0,label:"name","value-prop":"id",placeholder:"請選擇廠牌",disabled:!o.editableFields.brand_id,required:""},null,8,["modelValue","options","disabled"]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[10]||(t[10]=e=>o.toggleEdit("brand_id"))},(0,l.v_)(o.editableFields.brand_id?"完成":"修改"),1)])]),(0,r.Lk)("div",ln,[t[21]||(t[21]=(0,r.Lk)("label",{for:"productTags",class:"form-label"},"標籤",-1)),(0,r.Lk)("div",cn,[(0,r.bF)(c,{modelValue:o.productForm.tag_ids,"onUpdate:modelValue":t[11]||(t[11]=e=>o.productForm.tag_ids=e),options:o.tags,label:"name","value-prop":"id",placeholder:"請選擇標籤",disabled:!o.editableFields.tag_ids,required:"",multiple:""},{tag:(0,r.k6)((({option:e,remove:t})=>[(0,r.Lk)("span",dn,[(0,r.eW)((0,l.v_)(e.name)+" ",1),(0,r.Lk)("button",{type:"button",onClick:a=>t(e)}," X ",8,un)])])),_:1},8,["modelValue","options","disabled"]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[12]||(t[12]=e=>o.toggleEdit("tag_ids"))},(0,l.v_)(o.editableFields.tag_ids?"完成":"修改"),1)])]),t[22]||(t[22]=(0,r.Lk)("button",{type:"submit",class:"btn btn-primary"},"更新產品",-1))],32))])}var mn=a(4014),gn={name:"EditProduct",components:{Multiselect:mn.A},setup(){const e=(0,Q.rd)(),t=(0,Q.lq)(),a=t.params.id,s=(0,we.KR)(!0),o=(0,we.Kh)({name:!1,price:!1,stock:!1,description:!1,brand_id:!1,tag_ids:!1}),i=e=>{o[e]=!o[e]},n=(0,we.Kh)({name:"",description:"",price:0,stock:0,brand_id:null,tag_ids:[],imageFile:null,imagePreview:""}),l=(0,we.KR)([]),c=(0,we.KR)([]),d=async()=>{try{s.value=!0;const[e,t,r]=await Promise.all([axios.get(`/api/products/${a}`),axios.get("/api/brands"),axios.get("/api/tags")]);l.value=t.data,c.value=r.data;const o=e.data;n.name=o.name,n.description=o.description,n.price=o.price,n.stock=o.stock,n.imagePreview=o.image?`/${o.image}`:"",o.brand_id&&(n.brand_id=Number(o.brand_id)),o.tag_ids&&Array.isArray(o.tag_ids)&&(n.tag_ids=o.tag_ids.map((e=>Number(e)))),console.log("成功讀取資料！",{product:o,selectedBrand:n.brand_id,selectedTags:n.tag_ids})}catch(e){console.error("加載商品訊息時出錯",e),alert("加載商品訊息時出錯，請稍後再試！")}finally{s.value=!1}},u=async()=>{try{if(!n.name)return void alert("請填寫商品名稱");if(!n.description)return void alert("請填寫商品描述");if(!n.price||isNaN(n.price))return void alert("請填寫有效的商品價格");if(!n.stock||isNaN(n.stock))return void alert("請填寫有效的商品庫存");if(!n.brand_id||isNaN(n.brand_id))return void alert("請選擇一個有效的廠牌");const t=new FormData;t.append("name",n.name),t.append("description",n.description),t.append("price",n.price),t.append("stock",n.stock),t.append("brand_id",n.brand_id),t.append("tag_ids",JSON.stringify(n.tag_ids)),n.imageFile&&t.append("image",n.imageFile),await axios.put(`/api/products/${a}`,t,{headers:{"Content-Type":"multipart/form-data"}}),alert("更新商品成功！"),e.push({name:"AdminProducts"})}catch(t){console.error("更新商品時出錯:",t),alert("更新商品時出錯，請稍後再試！")}},p=e=>{const t=e.target.files[0];t&&(n.imageFile=t,n.imagePreview=URL.createObjectURL(t))};return(0,r.sV)((async()=>{await d()})),{productForm:n,brands:l,tags:c,isLoading:s,editableFields:o,toggleEdit:i,updateProduct:u,selectImage:p}}};const hn=(0,I.A)(gn,[["render",pn]]);var kn=hn;function bn(e,t,a,s,o,i){return(0,r.uX)(),(0,r.CE)("h5",null,"AdminContact")}var fn={name:"AdminContact"};const vn=(0,I.A)(fn,[["render",bn]]);var Ln=vn;const yn={class:"order-detail container mt-5"},wn={key:0},Cn={class:"order-info mb-4"},In={class:"mb-3"},_n={class:"table table-bordered"},Pn={key:1};function An(e,t,a,o,i,n){return(0,r.uX)(),(0,r.CE)("div",yn,[t[13]||(t[13]=(0,r.Lk)("h2",{class:"text-center"},"訂單詳情",-1)),i.order?((0,r.uX)(),(0,r.CE)("div",wn,[(0,r.Lk)("div",Cn,[(0,r.Lk)("p",null,[t[3]||(t[3]=(0,r.Lk)("strong",null,"訂單號：",-1)),(0,r.eW)((0,l.v_)(i.order.id),1)]),(0,r.Lk)("p",null,[t[4]||(t[4]=(0,r.Lk)("strong",null,"會員編號：",-1)),(0,r.eW)((0,l.v_)(i.order.user_id),1)]),(0,r.Lk)("p",null,[t[5]||(t[5]=(0,r.Lk)("strong",null,"用戶名：",-1)),(0,r.eW)((0,l.v_)(i.userName),1)]),(0,r.Lk)("p",null,[t[6]||(t[6]=(0,r.Lk)("strong",null,"建立日期：",-1)),(0,r.eW)((0,l.v_)(n.formatDate(i.order.orderDate)),1)]),(0,r.Lk)("p",null,[t[7]||(t[7]=(0,r.Lk)("strong",null,"總金額：",-1)),(0,r.eW)((0,l.v_)(n.formatCurrency(i.order.total)),1)]),(0,r.Lk)("div",In,[t[9]||(t[9]=(0,r.Lk)("label",{for:"orderStatus",class:"form-label"},[(0,r.Lk)("strong",null,"訂單狀態：")],-1)),(0,r.bo)((0,r.Lk)("select",{id:"orderStatus","onUpdate:modelValue":t[0]||(t[0]=e=>i.order.status=e),class:"form-select",onChange:t[1]||(t[1]=(...e)=>n.updateOrderStatus&&n.updateOrderStatus(...e))},t[8]||(t[8]=[(0,r.Lk)("option",{value:"pending"},"待確認",-1),(0,r.Lk)("option",{value:"shipped"},"已發貨",-1),(0,r.Lk)("option",{value:"completed"},"已完成",-1),(0,r.Lk)("option",{value:"cancelled"},"已取消",-1)]),544),[[s.u1,i.order.status]])])]),t[11]||(t[11]=(0,r.Lk)("h4",null,"商品列表",-1)),(0,r.Lk)("table",_n,[t[10]||(t[10]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"商品名稱"),(0,r.Lk)("th",null,"數量"),(0,r.Lk)("th",null,"單價"),(0,r.Lk)("th",null,"小計")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.order.items,(e=>((0,r.uX)(),(0,r.CE)("tr",{key:e.productId},[(0,r.Lk)("td",null,(0,l.v_)(e.product_name),1),(0,r.Lk)("td",null,(0,l.v_)(e.quantity),1),(0,r.Lk)("td",null,(0,l.v_)(n.formatCurrency(e.price)),1),(0,r.Lk)("td",null,(0,l.v_)(n.formatCurrency(e.price*e.quantity)),1)])))),128))])]),(0,r.Lk)("button",{class:"btn btn-secondary mt-3",onClick:t[2]||(t[2]=(...e)=>n.goBack&&n.goBack(...e))},"返回")])):((0,r.uX)(),(0,r.CE)("div",Pn,t[12]||(t[12]=[(0,r.Lk)("p",null,"正在加載訂單詳情...",-1)])))])}var En={name:"OrderDetail",props:["id"],data(){return{order:null,userName:"",store:(0,R.Pj)()}},methods:{async fetchOrderDetails(e){try{const t=await ne.A.orderAPI.getOrderById(e);this.order=t||t.data,this.fetchUserName(this.order.user_id)}catch(t){console.error("加載訂單詳情時出錯",t),alert("加載訂單詳情時出錯，請稍候再試！"),this.order=null}},async fetchUserName(e){try{const t=await ne.A.userAPI.getUserInfo(e),a=t.data||t;this.userName=a.name||"未知用戶"}catch(t){console.error("加載用戶資訊時出錯",t),this.userName="未知用戶"}},formatCurrency(e){return new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},formatDate(e){const t={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(e).toLocaleDateString("zh-TW",t)},async updateOrderStatus(){if(this.order)try{await ne.A.orderAPI.updateOrderStatus(this.order.id,this.order.status),store.dispatch("notification/showNotification",{message:"訂單狀態已更新",type:"success",timeout:3e3}),alert("訂單狀態已更新")}catch(e){console.error("更新訂單狀態時出錯",e),store.dispatch("notifications/showNotification",{type:"error",message:"更新訂單狀態時出錯，請稍後再試！",timeout:2e3})}},goBack(){this.$router.go(-1)}},mounted(){const e=this.id||this.$route.params.id;this.fetchOrderDetails(e)}};const Fn=(0,I.A)(En,[["render",An],["__scopeId","data-v-36c506e4"]]);var Sn=Fn;const On={class:"carousel-management container mt-5"},xn={class:"image-grid mb-4"},Tn={class:"image-wrapper"},Un=["src"],Dn={class:"image-overlay"},Nn={class:"action-buttons"},Rn=["onClick"],$n=["onClick"],Mn={class:"image-status mt-2"},Xn={class:"upload-section p-4 bg-light rounded-3"},qn={key:0,class:"preview-section mt-4"},Wn={class:"preview-container"},Bn=["src"],Vn={class:"preview-actions mt-3"};function Kn(e,t,a,o,i,n){return(0,r.uX)(),(0,r.CE)("div",On,[t[14]||(t[14]=(0,r.Lk)("div",{class:"dashboard-header mb-4"},[(0,r.Lk)("h2",{class:"text-primary fw-bold"},"輪播圖片管理"),(0,r.Lk)("p",{class:"text-muted"},"管理網站首頁輪播圖片的顯示與排序")],-1)),(0,r.Lk)("div",xn,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.carouselImages,(a=>((0,r.uX)(),(0,r.CE)("div",{key:a.id,class:"image-card"},[(0,r.Lk)("div",Tn,[(0,r.Lk)("img",{src:e.$getImageUrl(a.url,"carousel"),onLoad:t[0]||(t[0]=t=>n.onImgLoad(e.index)),onError:t[1]||(t[1]=t=>n.onImgError(e.index)),class:"carousel-image",alt:"輪播圖片"},null,40,Un),(0,r.Lk)("div",Dn,[(0,r.Lk)("div",Nn,[(0,r.Lk)("button",{class:(0,l.C4)(["btn btn-light btn-sm me-2",{active:a.visible}]),onClick:e=>n.toggleImageVisibility(a)},[(0,r.Lk)("i",{class:(0,l.C4)(a.visible?"fas fa-eye":"fas fa-eye-slash")},null,2),(0,r.eW)(" "+(0,l.v_)(a.visible?"隱藏":"顯示"),1)],10,Rn),(0,r.Lk)("button",{class:"btn btn-danger btn-sm",onClick:e=>n.deleteCarouselImage(a.id)},t[8]||(t[8]=[(0,r.Lk)("i",{class:"fas fa-trash-alt me-1"},null,-1),(0,r.eW)(" 刪除 ")]),8,$n)])])]),(0,r.Lk)("div",Mn,[(0,r.Lk)("span",{class:(0,l.C4)(["status-badge",a.visible?"status-active":"status-inactive"])},(0,l.v_)(a.visible?"顯示中":"已隱藏"),3)])])))),128))]),(0,r.Lk)("div",Xn,[t[13]||(t[13]=(0,r.Lk)("h4",{class:"mb-3"},[(0,r.Lk)("i",{class:"fas fa-cloud-upload-alt me-2"}),(0,r.eW)(" 上傳新圖片 ")],-1)),(0,r.Lk)("div",{class:(0,l.C4)(["upload-area",{dragging:i.isDragging}]),onDragover:t[4]||(t[4]=(0,s.D$)((()=>{}),["prevent"])),onDrop:t[5]||(t[5]=(0,s.D$)(((...e)=>n.handleFileDrop&&n.handleFileDrop(...e)),["prevent"]))},[(0,r.Lk)("input",{type:"file",onChange:t[2]||(t[2]=(...e)=>n.handleFileSelect&&n.handleFileSelect(...e)),accept:"image/*",ref:"fileInput",class:"d-none"},null,544),(0,r.Lk)("div",{class:"upload-placeholder",onClick:t[3]||(t[3]=t=>e.$refs.fileInput.click())},t[9]||(t[9]=[(0,r.Lk)("i",{class:"fas fa-plus-circle fs-2 mb-2"},null,-1),(0,r.Lk)("p",{class:"mb-1"},"點擊或拖曳圖片至此處上傳",-1),(0,r.Lk)("small",{class:"text-muted"},"支援 JPG、PNG、GIF 格式，檔案大小不超過 5MB",-1)]))],34),i.previewUrl?((0,r.uX)(),(0,r.CE)("div",qn,[t[12]||(t[12]=(0,r.Lk)("h5",{class:"mb-3"},"預覽圖片",-1)),(0,r.Lk)("div",Wn,[(0,r.Lk)("img",{src:i.previewUrl,alt:"預覽圖片",class:"preview-image"},null,8,Bn),(0,r.Lk)("div",Vn,[(0,r.Lk)("button",{class:"btn btn-primary me-2",onClick:t[6]||(t[6]=(...e)=>n.confirmUpload&&n.confirmUpload(...e))},t[10]||(t[10]=[(0,r.Lk)("i",{class:"fas fa-check me-1"},null,-1),(0,r.eW)("確認上傳 ")])),(0,r.Lk)("button",{class:"btn btn-outline-secondary",onClick:t[7]||(t[7]=(...e)=>n.cancelUpload&&n.cancelUpload(...e))},t[11]||(t[11]=[(0,r.Lk)("i",{class:"fas fa-times me-1"},null,-1),(0,r.eW)("取消 ")]))])])])):(0,r.Q3)("",!0)]),i.showToast?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,l.C4)(["toast-notification",`toast-${i.toastType}`])},(0,l.v_)(i.toastMessage),3)):(0,r.Q3)("",!0)])}var jn={name:"AdminCarouselImages",data(){return{carouselImages:[],selectedFile:null,previewUrl:"",isDragging:!1,showToast:!1,toastMessage:"",toastType:"success"}},async mounted(){await this.loadCarouselImages()},methods:{async loadCarouselImages(){try{const e=await ne.A.carouselAPI.getCarouselImages();this.carouselImages=e,console.log("後端回傳的輪播資料:",this.carouselImages),this.carouselImages.forEach(((e,t)=>{console.log(`[carouselImages] index=${t}, url=`,e.url)}))}catch(e){Kt(e,"加載輪播圖片失敗")}},handleFileSelect(e){const t=e.target.files[0];if(t){const e=["image/jpeg","image/png","image/gif"],a=5242880;if(!e.includes(t.type))return void alert("僅支援JPEG, PNG, GIF 格式的圖片！");if(t.size>a)return void alert("圖片超出5MB的上限！");this.selectedFile=t,this.previewUrl=URL.createObjectURL(t)}},async confirmUpload(){if(!this.selectedFile)return void alert("沒有選擇任何文件！");const e=new FormData;e.append("image",this.selectedFile);try{const t=await ne.A.carouselAPI.uploadCarouselImages(e);this.carouselImages.push(t),alert("圖片上傳成功"),this.resetUpload()}catch(t){Kt(t,"圖片上傳失敗")}},cancelUpload(){this.resetUpload()},resetUpload(){this.selectedFile=null,this.previewUrl="",this.$refs.fileInput.value=""},async deleteCarouselImage(e){if(confirm("確定要刪除這張圖片嗎？"))try{await ne.A.carouselAPI.deleteCarouselImage(e),this.carouselImages=this.carouselImages.filter((t=>t.id!==e)),alert("圖片已刪除。")}catch(t){Kt(t,"圖片刪除失敗")}},async toggleImageVisibility(e){const t=!e.visible;try{const a=await ne.A.carouselAPI.updateCarouselImage(e.id,{visible:t});e.visible=a.visible,alert(`圖片已${t?"顯示":"隱藏"}。`)}catch(a){Kt(a,"更新圖片狀態失敗")}},onImgLoad(e){console.log(`image #${e} 載入成功！`)},onImgError(e){console.error(`image #${e} 載入失敗！`)},handleFileDrop(e){this.isDragging=!1;const t=e.dataTransfer.files[0];t&&this.handleFile(t)},showNotification(e,t="success"){this.toastMessage=e,this.toastType=t,this.showToast=!0,setTimeout((()=>{this.showToast=!1}),3e3)}}};const Qn=(0,I.A)(jn,[["render",Kn],["__scopeId","data-v-4f2d086e"]]);var Jn=Qn;const zn={class:"special-offers-dashboard container mt-5"},Hn={class:"d-flex justify-content-end mb-3"},Gn={class:"accordion",id:"specialOffersAccordion"},Zn={class:"accordion-item"},Yn={id:"collapseSpecialOffers",class:"accordion-collapse collapse show","aria-labelledby":"headingSpecialOffers","data-bs-parent":"#specialOffersAccordion"},el={class:"accordion-body"},tl={class:"table"},al=["onClick"],sl=["onClick"],rl={class:"modal fade",tabindex:"-1",ref:"specialOfferModal"},ol={class:"modal-dialog"},il={class:"modal-content"},nl={class:"modal-header"},ll={class:"modal-title"},cl={class:"modal-body"},dl={class:"mb-3"},ul={key:0,class:"list-group mt-2"},pl=["onClick"],ml={key:1,class:"mt-2"},gl={class:"mb-3"},hl={class:"mb-3"},kl={class:"mb-3"},bl={class:"modal-footer"};function fl(e,t,a,o,i,n){return(0,r.uX)(),(0,r.CE)("div",zn,[t[17]||(t[17]=(0,r.Lk)("h2",{class:"text-center"},"特價商品管理",-1)),(0,r.Lk)("div",Hn,[(0,r.Lk)("button",{class:"btn btn-success",onClick:t[0]||(t[0]=(...e)=>n.openCreateSpecialOfferModal&&n.openCreateSpecialOfferModal(...e))},"新增特價商品")]),(0,r.Lk)("div",Gn,[(0,r.Lk)("div",Zn,[t[11]||(t[11]=(0,r.Lk)("h2",{class:"accordion-header",id:"headingSpecialOffers"},[(0,r.Lk)("button",{class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseSpecialOffers","aria-expanded":"true","aria-controls":"collapseSpecialOffers"}," 特價商品管理 ")],-1)),(0,r.Lk)("div",Yn,[(0,r.Lk)("div",el,[(0,r.Lk)("table",tl,[t[10]||(t[10]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"商品名稱"),(0,r.Lk)("th",null,"特價價格"),(0,r.Lk)("th",null,"倒數時間 (秒)"),(0,r.Lk)("th",null,"創建日期"),(0,r.Lk)("th",null,"操作")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.specialOffers,((e,t)=>((0,r.uX)(),(0,r.CE)("tr",{key:e?.id},[(0,r.Lk)("td",null,(0,l.v_)(n.getProductName(e.product_id)),1),(0,r.Lk)("td",null,(0,l.v_)(e.price),1),(0,r.Lk)("td",null,(0,l.v_)(e.countdown),1),(0,r.Lk)("td",null,(0,l.v_)(n.formatDate(e.created_at)),1),(0,r.Lk)("td",null,[(0,r.Lk)("button",{class:"btn btn-warning btn-sm me-2",onClick:e=>n.openEditSpecialOfferModal(t)},"編輯",8,al),(0,r.Lk)("button",{class:"btn btn-danger btn-sm",onClick:a=>n.deleteSpecialOffer(e.id,t)},"刪除",8,sl)])])))),128))])])])])])]),(0,r.Lk)("div",rl,[(0,r.Lk)("div",ol,[(0,r.Lk)("div",il,[(0,r.Lk)("div",nl,[(0,r.Lk)("h5",ll,(0,l.v_)(i.isEditing?"編輯特價商品":"新增特價商品"),1),(0,r.Lk)("button",{type:"button",class:"btn-close",onClick:t[1]||(t[1]=(...e)=>n.closeSpecialOfferModal&&n.closeSpecialOfferModal(...e))})]),(0,r.Lk)("div",cl,[(0,r.Lk)("div",dl,[t[13]||(t[13]=(0,r.Lk)("label",{for:"productSelect",class:"form-label"},"搜尋商品名稱",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"productSearch",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=e=>i.productSearchKeyword=e),onInput:t[3]||(t[3]=(...t)=>e.debouncedSearchProducts&&e.debouncedSearchProducts(...t)),required:""},null,544),[[s.Jo,i.productSearchKeyword]]),i.searchResults&&i.searchResults.length>0?((0,r.uX)(),(0,r.CE)("ul",ul,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.searchResults,(e=>((0,r.uX)(),(0,r.CE)("li",{class:"list-group-item list-group-item-action",key:e.id,onClick:t=>n.selectProduct(e)},(0,l.v_)(e.name),9,pl)))),128))])):(0,r.Q3)("",!0),i.selectedProduct?((0,r.uX)(),(0,r.CE)("div",ml,[t[12]||(t[12]=(0,r.Lk)("strong",null,"已選擇商品：",-1)),(0,r.eW)((0,l.v_)(i.selectedProduct.name)+" ",1),(0,r.Lk)("button",{type:"button",class:"btn btn-sm btn-outline-danger ms-2",onClick:t[4]||(t[4]=(...e)=>n.clearSelectedProduct&&n.clearSelectedProduct(...e))},"移除")])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",gl,[t[14]||(t[14]=(0,r.Lk)("label",{for:"priceInput",class:"form-label"},"特價價格",-1)),(0,r.bo)((0,r.Lk)("input",{type:"number",id:"priceInput","onUpdate:modelValue":t[5]||(t[5]=e=>i.specialOfferForm.price=e),class:"form-control",placeholder:"請輸入特價價格",required:""},null,512),[[s.Jo,i.specialOfferForm.price]])]),(0,r.Lk)("div",hl,[t[15]||(t[15]=(0,r.Lk)("label",{for:"countdownInput",class:"form-label"},"倒數時間 (秒)",-1)),(0,r.bo)((0,r.Lk)("input",{type:"number",id:"countdownInput","onUpdate:modelValue":t[6]||(t[6]=e=>i.specialOfferForm.countdown=e),class:"form-control",placeholder:"請輸入倒數時間",required:""},null,512),[[s.Jo,i.specialOfferForm.countdown]])]),(0,r.Lk)("div",kl,[t[16]||(t[16]=(0,r.Lk)("label",{for:"createdAtInput",class:"form-label"},"創建日期",-1)),(0,r.bo)((0,r.Lk)("input",{type:"date",id:"createdAtInput","onUpdate:modelValue":t[7]||(t[7]=e=>i.specialOfferForm.created_at=e),class:"form-control",required:""},null,512),[[s.Jo,i.specialOfferForm.created_at]])])]),(0,r.Lk)("div",bl,[(0,r.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[8]||(t[8]=(...e)=>n.closeSpecialOfferModal&&n.closeSpecialOfferModal(...e))},"取消"),(0,r.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[9]||(t[9]=(...e)=>n.saveSpecialOffer&&n.saveSpecialOffer(...e))},(0,l.v_)(i.isEditing?"保存變更":"新增特價商品"),1)])])])],512)])}var vl={name:"SpecialOffers",data(){return{specialOffers:[],products:[],productMap:{},specialOfferForm:{id:null,product_id:"",price:0,countdown:0,created_at:""},isEditing:!1,currentIndex:null,productSearchKeyword:"",searchResults:[],selectedProduct:null}},mounted(){this.loadSpecialOffers(),this.loadProducts(),this.debouncedSearchProducts=yi()(this.searchProducts,500)},methods:{async loadSpecialOffers(){try{const e=await ne.A.specialOffersAPI.getAllSpecialOffers();console.log("loadSpecialOffers response:",e),this.specialOffers=e}catch(e){Kt(e,"加載特價商品時出錯，請稍後再試！")}},async searchProducts(){const e=this.productSearchKeyword.trim();if(e)try{const t=await ne.A.productAPI.searchProducts({keyword:e,page:1,limit:10});this.searchResults=t}catch(t){Kt(t,"搜尋商品時出錯，請稍後再試！")}else this.searchResults=[]},selectProduct(e){this.selectedProduct=e,this.specialOfferForm.product_id=e.id,this.searchResults=[],this.productSearchKeyword=""},clearSelectedProduct(){this.selectedProduct=null,this.specialOfferForm.product_id=""},async loadProducts(){try{const e=await ne.A.productAPI.getAllProducts();this.products=e,this.productMap={},e.forEach((e=>{this.productMap[e.id]=e.name}))}catch(e){Kt(e,"加載商品時出錯，請稍後再試！")}},formatDate(e){const t=new Date(e);return t.toLocaleDateString()},openCreateSpecialOfferModal(){this.isEditing=!1,this.specialOfferForm={id:null,product_id:"",price:0,countdown:0,created_at:""},this.selectedProduct=null,this.productSearchKeyword="",this.searchResults=[],this.$nextTick((()=>{const e=new K.aF(this.$refs.specialOfferModal);e.show()}))},async openEditSpecialOfferModal(e){this.isEditing=!0,this.currentIndex=e;const t={...this.specialOffers[e]};this.specialOfferForm=t;try{const e=await ne.A.specialOffersAPI.getSpecialOfferById(t.id);this.selectedProduct=e}catch(a){Kt(a,"取得商品資訊時出錯，請稍後再試！")}this.productSearchKeyword="",this.searchResults=[],this.$nextTick((()=>{const e=new K.aF(this.$refs.specialOfferModal);e.show()}))},getProductName(e){return this.productMap[e]||"未知商品"},closeSpecialOfferModal(){const e=K.aF.getInstance(this.$refs.specialOfferModal);e&&e.hide()},async saveSpecialOffer(){if(this.specialOfferForm.product_id&&this.specialOfferForm.price&&this.specialOfferForm.countdown&&this.specialOfferForm.created_at)try{if(this.isEditing){const e=await ne.A.specialOffersAPI.updateSpecialOfferById(this.specialOfferForm.id,this.specialOfferForm);this.$set(this.specialOffers,this.currentIndex,e),alert("特價商品已更新！")}else{const e=await ne.A.specialOffersAPI.createSpecialOffer(this.specialOfferForm);this.specialOffers.push(e),alert("特價商品已新增！")}this.closeSpecialOfferModal()}catch(e){Kt(e,"保存特價商品時出錯，請稍後再試！")}else alert("請填寫所有必填欄位！")},async deleteSpecialOffer(e,t){if(confirm("確定要刪除此特價商品？"))try{await ne.A.specialOffersAPI.deleteSpecialOffer(e),this.specialOffers.splice(t,1),alert("特價商品已刪除！")}catch(a){Kt(a,"刪除特價商品時出錯，請稍後再試！")}}}};const Ll=(0,I.A)(vl,[["render",fl],["__scopeId","data-v-78d172d3"]]);var yl=Ll;const wl=(0,Q.aE)({history:(0,Q.LA)("/ECshop"),routes:[{path:"/",name:"HomePage",component:()=>Promise.resolve().then(a.bind(a,9882))},{path:"/admin",name:"AdminDashBoard",component:Js},{path:"/admin/Products",name:"AdminProducts",component:Zr},{path:"/admin/Users",name:"AdminUsers",component:Qo},{path:"/admin/Orders",name:"AdminOrders",component:Ii,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/Orders/:id(\\d+)",name:"OrderDetail",component:Sn,props:!0},{path:"/admin/CreateProduct",name:"CreateProduct",component:qi},{path:"/admin/EditProduct/:id",name:"EditProduct",component:kn},{path:"/admin/AdminContact",name:"AdminContact",component:Ln},{path:"/admin/CarouselImages",name:"CarouselImages",component:Jn},{path:"/admin/SpecialOffers",name:"SpecialOffers",component:yl},{path:"/ShopCart",name:"ShopCart",component:de,meta:{requiresAuth:!0}},{path:"/ProductsList",name:"ProductsList",component:Ue},{path:"/MembersPage",name:"MembersPage",component:Ht,meta:{requiresAuth:!0}},{path:"/AboutUsPage",name:"AboutUsPage",component:G},{path:"/ContactUs",name:"ContactUs",component:ea},{path:"/SearchResults",name:"SearchResults",component:ra},{path:"/UserRegister",name:"UserRegister",component:Fa},{path:"/UserLogin",name:"UserLogin",component:Wa},{path:"/ForgotPwd",name:"ForgotPwd",component:za},{path:"/ProductDetail/:id",name:"ProductDetail",component:He},{path:"/Order-Confirmation/:orderId",name:"OrderConfirmation",component:ss},{path:"/:pathMatch(.*)*",redirect:"/"}]});wl.beforeEach(((e,t,a)=>{const s=!!localStorage.getItem("authToken"),r=JSON.parse(localStorage.getItem("user")),o=r?r.role:null;e.matched.some((e=>e.meta.requiresAuth))?s?e.meta.role&&e.meta.role!==o?(alert("你沒有權限進入此頁面"),a({path:"/"})):a():(alert("請先登入再使用！"),a({path:"/UserLogin"})):a()}));var Cl=wl,Il=a(8029),_l=a(5720);const Pl=(e,t)=>{if(!e)return"/img/wrong.png";const a="https://ecshop-backend.onrender.com/api";switch(t){case"carousel":return`${a}/img/carouselImages/${e.split("/").pop()}`;case"product":return`${a}/img/products/${e.split("/").pop()}`;default:return e.startsWith("http")?e:`${a}${e}`}};const Al=(0,s.Ef)(B);Al.config.globalProperties.$axios=_l.A,Al.config.globalProperties.$getImageUrl=Pl,Al.use(Cl),Al.use(Il.A),Al.use(V.A),Al.use(j.Ay),console.log("環境變數檢查:",{NODE_ENV:"production",API_BASE_URL:"https://ecshop-backend.onrender.com/api",CAROUSEL_IMAGE_URL:"https://ecshop-backend.onrender.com/api/img/carouselImages",PRODUCT_IMAGE_URL:"https://ecshop-backend.onrender.com/api/img/products"}),Al.directive("tooltip",{mounted(e){new K.m_(e)},unmounted(e){const t=K.m_.getInstance(e);t&&t.dispose()}}),Il.A.dispatch("auth/checkAuthStatus").then((()=>{Al.mount("#app")})).catch((e=>{console.error("認證狀態檢查失敗:",e),Al.mount("#app")}))},4300:function(e,t,a){var s=a(5720),r=a(4373);const o={setHeader(e,t){s.A.defaults.headers.common[e]=t},userAPI:{getAllUsers:()=>s.A.get("/users"),login:e=>s.A.post("/users/login",e),register:e=>s.A.post("/users/register",e),getUserInfo:e=>s.A.get(`/users/${e}`),updateUser:(e,t)=>s.A.put(`/users/${e}`,t),getRecipients:()=>s.A.get("/recipients")},productAPI:{getProducts:e=>s.A.get("/products",{params:e}),getProductById:e=>s.A.get(`/products/${e}`),createProduct:e=>s.A.post("/products",e),updateProduct:(e,t)=>s.A.put(`/products/${e}`,t),deleteProduct:e=>s.A.delete(`/products/${e}`),getAllProducts:()=>s.A.get("/products"),searchProducts:e=>s.A.get("/products/search",{params:e})},tagAPI:{getAllTags:()=>s.A.get("/tags"),createTag:e=>s.A.post("/tags",e),updateTag:(e,t)=>s.A.put(`/tags/${e}`,t),deleteTag:e=>s.A.delete(`/tags/${e}`)},brandAPI:{getAllBrands:()=>s.A.get("/brands"),createBrand:e=>s.A.post("/brands",e),updateBrand:(e,t)=>s.A.put(`/brands/${e}`,t),deleteBrand:e=>s.A.delete(`/brands/${e}`)},orderAPI:{createOrder:e=>s.A.post("/orders",e),getOrders:()=>s.A.get("/orders"),getOrderById:e=>s.A.get(`/orders/${e}`),updateOrder:(e,t)=>s.A.put(`/orders/${e}`,t)},recipientAPI:{getRecipients:e=>s.A.get("/recipients",{params:{user_id:e}}),updateRecipient:(e,t)=>s.A.put(`/recipients/${e}`,t),addRecipient:e=>s.A.post("/recipients",e),deleteRecipient:e=>s.A.delete(`/recipients/${e}`)},carouselAPI:{getAllCarouselImages:()=>s.A.get("/carousel_images"),getCarouselImages:()=>s.A.get("/carousel_images"),uploadCarouselImages:e=>s.A.post("/carousel_images",e,{headers:{"Content-Type":"multipart/form-data"}}),updateCarouselImage:(e,t)=>s.A.put(`/carousel_images/${e}`,t),deleteCarouselImage:e=>s.A.delete(`/carousel_images/${e}`)},specialOffersAPI:{getAllSpecialOffers:()=>s.A.get("/special_offers"),getSpecialOfferById:e=>s.A.get(`/special_offers/${e}`),createSpecialOffer:e=>s.A.post("/special_offers",e),updateSpecialOffer:(e,t)=>s.A.put(`/special_offers/${e}`,t),deleteSpecialOffer:e=>s.A.delete(`/special_offers/${e}`)},rankingAPI:{getRanking:e=>s.A.get("/ranking",{params:{days:e},baseURL:"https://ecshop-backend.onrender.com/api"})},createCancelToken:()=>{const e=r.A.CancelToken.source();return e}};t.A=o},8029:function(e,t,a){a.d(t,{A:function(){return b}});var s=a(782),r=(a(4114),a(8992),a(2577),a(8872),{namespaced:!0,state:{items:[]},getters:{cartItems:e=>e.items,cartTotal:e=>e.items.reduce(((e,t)=>e+t.price*t.quantity),0),cartItemCount:e=>e.items.reduce(((e,t)=>e+t.quantity),0)},mutations:{addToCart(e,t){const a=Number(t.price);if(isNaN(a)||!t.id||!t.name)return void console.error("Invalid price value",t);const s=e.items.find((e=>e.id===t.id));s?s.quantity++:e.items.push({id:t.id,name:t.name,price:a,image:t.image||"/backend/public/img/wrong.png",quantity:1})},removeFromCart(e,t){e.items.splice(t,1)},updateCartItemQuantity(e,{index:t,quantity:a}){e.items[t].quantity=a<1?1:a},clearCart(e){e.items=[]}},actions:{addProductToCart({commit:e},t){t&&t.id?e("addToCart",t):console.error("Invalid product data")},removeItemFromCart({commit:e},t){e("removeFromCart",t)},updateItemQuantity({commit:e},t){e("updateCartItemQuantity",t)},clearShoppingCart({commit:e}){e("clearCart")}}}),o=a(4300),i={namespaced:!0,state:{isLoggedIn:!1,user:{role:""},showLoginModal:!1},mutations:{login(e,t){e.isLoggedIn=!0,e.user=t},logout(e){e.isLoggedIn=!1,e.user=null,localStorage.removeItem("user"),localStorage.removeItem("authToken")},setShowLoginModal(e,t){e.showLoginModal=t}},actions:{async login({commit:e},t){try{const a=await o.A.userAPI.login(t),{data:s}=a;if(console.log("Login Response Data:",s),!s||!s.token)throw new Error("無法取得用戶資料或 token");const{token:r}=s,{id:i,name:n,email:l,role:c,phone:d,address:u}=s,p={id:i,name:n,email:l,role:c,phone:d,address:u};return localStorage.setItem("authToken",r),localStorage.setItem("user",JSON.stringify(p)),console.log("authToken stored:",r),console.log("Stored Token:",r),console.log("Stored User:",p),e("login",p),a}catch(a){throw console.error("登入失敗:",a),a}},async checkAuthStatus({commit:e}){localStorage.getItem("authToken"),JSON.parse(localStorage.getItem("user"));return e("logout"),!1},logout({commit:e}){e("logout"),localStorage.removeItem("authToken"),localStorage.removeItem("user")},showLoginModal({commit:e},t){e("setShowLoginModal",t)}},getters:{isLoggedIn:e=>e.isLoggedIn,user:e=>e.user,showLoginModal:e=>e.showLoginModal}};a(7550);const n={notifications:[]},l=3,c=2e3,d={ADD_NOTIFICATION(e,t){if(!t.message||!t.type)return void console.error("Invalid notification data");e.notifications.length>=l&&e.notifications.shift();const a=e.notifications.some((e=>e.message===t.message&&e.type===t.type));a||(e.notifications.length>=l&&e.notifications.shift(),e.notifications.push(t))},REMOVE_NOTIFICATION(e,t){const a=e.notifications.findIndex((e=>e.id===t));-1!==a&&e.notifications.splice(a,1)}},u={showNotification({commit:e},{message:t,type:a,timeout:s=c}){if(!t||!a)return void console.error("Missing required notification parameters");const r=Date.now(),o={id:r,message:t,type:a};e("ADD_NOTIFICATION",o),s>0&&setTimeout((()=>{e("REMOVE_NOTIFICATION",r)}),s)},removeNotification({commit:e},t){e("REMOVE_NOTIFICATION",t)}};var p={namespaced:!0,state:n,mutations:d,actions:u},m=a(5131);const g=(0,s.y$)({modules:{cart:r,auth:i,notifications:p},plugins:[(0,m.A)()]}),h=localStorage.getItem("authToken"),k=localStorage.getItem("user");h&&k&&g.commit("auth/login",JSON.parse(k));var b=(0,s.y$)({modules:{cart:r,auth:i,notifications:p},plugins:[(0,m.A)()]})},5720:function(e,t,a){var s=a(4373);a(8029);const r=s.A.create({baseURL:"https://ecshop-backend.onrender.com/api",timeout:1e4,withCredentials:!0});r.interceptors.request.use((e=>{const t=localStorage.getItem("authToken");return console.log("🚀 發送請求:",{url:e.url,method:e.method,baseURL:e.baseURL,headers:e.headers,data:e.data}),t&&(e.headers["Authorization"]=`Bearer ${t}`),e.headers["Content-Type"]||(e.headers["Content-Type"]="application/json"),e}),(e=>(console.error("❌ 請求發送失敗:",e),Promise.reject(e)))),r.interceptors.response.use((e=>(console.log("✅ 收到回應:",{status:e.status,url:e.config.url,data:e.data}),e.data)),(e=>{console.error("❌ 回應錯誤:",{status:e.response?.status,url:e.config?.url,message:e.message,response:e.response?.data});const{response:t}=e;let a="發生錯誤";return t||"ECONNABORTED"===e.code&&(a="請求超時，請稍後再試！"),Promise.reject(new Error(a))})),t.A=r},9882:function(e,t,a){a.r(t),a.d(t,{default:function(){return q}});var s=a(6768),r=a(4232);const o={class:"homepage container mt-5"},i={class:"carousel-section"},n={key:0,class:"loading-spinner"},l={key:1,class:"alert alert-warning"},c={key:2,id:"mainCarousel",class:"carousel slide position-relative carousel-fade","data-bs-ride":"carousel"},d={class:"carousel-indicators custom-indicators"},u=["data-bs-slide-to","aria-current","aria-label"],p={class:"carousel-inner rounded-4 shadow-lg"},m={class:"carousel-image-container"},g=["src"],h={key:0,class:"product-section mt-5"},k={class:"product-grid"},b={class:"product-image-wrapper"},f=["src"],v={class:"product-overlay"},L=["onClick"],y={class:"product-info"},w={class:"product-name"},C={key:0,class:"product-tag"},I={key:1,class:"sales-ranking mt-5"},_={class:"product-list"},P=["src"],A={key:2,class:"sales-ranking mt-5"},E={class:"product-list"},F=["src"],S={key:3,class:"countdown-special-offers mt-4"},O={class:"product-list"},x=["src"],T={class:"countdown-timer"};function U(e,t,a,U,D,N){return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",o,[(0,s.Lk)("div",i,[D.isLoading.carousel?((0,s.uX)(),(0,s.CE)("div",n,t[5]||(t[5]=[(0,s.Lk)("div",{class:"spinner-border",role:"status"},[(0,s.Lk)("span",{class:"visually-hidden"},"加載中...")],-1)]))):D.errors.carousel?((0,s.uX)(),(0,s.CE)("div",l,(0,r.v_)(D.errors.carousel),1)):D.carouselImages&&D.carouselImages.length?((0,s.uX)(),(0,s.CE)("div",c,[(0,s.Lk)("div",d,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(D.carouselImages,((e,t)=>((0,s.uX)(),(0,s.CE)("button",{key:"indicator-"+t,type:"button","data-bs-target":"#mainCarousel","data-bs-slide-to":t,class:(0,r.C4)([{active:0===t},"indicator-dot"]),"aria-current":0===t,"aria-label":"Slide"+(t+1)},null,10,u)))),128))]),(0,s.Lk)("div",p,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(D.carouselImages,((a,o)=>((0,s.uX)(),(0,s.CE)("div",{key:"slide-"+o,class:(0,r.C4)(["carousel-item",{active:0===o}])},[(0,s.Lk)("div",m,[(0,s.Lk)("img",{src:e.$getImageUrl(a.url,"carousel"),class:"d-block w-100",alt:"商品圖片",onError:t[0]||(t[0]=(...t)=>e.handleImageError&&e.handleImageError(...t))},null,40,g)])],2)))),128))]),t[6]||(t[6]=(0,s.Fv)('<button class="carousel-control-prev custom-control" type="button" data-bs-target="#mainCarousel" data-bs-slide="prev" data-v-1e9736fc><span class="carousel-control-prev-icon" aria-hidden="true" data-v-1e9736fc></span><span class="visually-hidden" data-v-1e9736fc>Previous</span></button><button class="carousel-control-next custom-control" type="button" data-bs-target="#mainCarousel" data-bs-slide="next" data-v-1e9736fc><span class="carousel-control-next-icon" aria-hidden="true" data-v-1e9736fc></span><span class="visually-hidden" data-v-1e9736fc>Next</span></button>',2))])):(0,s.Q3)("",!0)])]),D.randomProducts&&D.randomProducts.length>0?((0,s.uX)(),(0,s.CE)("div",h,[t[7]||(t[7]=(0,s.Lk)("div",{class:"section-header"},[(0,s.Lk)("h2",{class:"section-title"},"為您推薦"),(0,s.Lk)("div",{class:"section-subtitle"},"精選優質商品，專屬於您")],-1)),(0,s.Lk)("div",k,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(D.randomProducts,((a,o)=>((0,s.uX)(),(0,s.CE)("div",{key:o,class:"product-card",style:(0,r.Tr)({animationDelay:.1*o+"s"})},[(0,s.Lk)("div",b,[(0,s.Lk)("img",{src:e.$getImageUrl(a.image,"product"),class:"product-image",onError:t[1]||(t[1]=(...t)=>e.handleImageError&&e.handleImageError(...t))},null,40,f),(0,s.Lk)("div",v,[(0,s.Lk)("button",{class:"view-details-btn",onClick:e=>N.viewDetails(a)}," 查看詳情 ",8,L)])]),(0,s.Lk)("div",y,[(0,s.Lk)("h3",w,(0,r.v_)(a.name),1),"-"===a.quantity_sold?((0,s.uX)(),(0,s.CE)("div",C,"熱門推薦")):(0,s.Q3)("",!0)])],4)))),128))])])):(0,s.Q3)("",!0),D.sevenDaySalesRanking&&D.sevenDaySalesRanking.length>0?((0,s.uX)(),(0,s.CE)("div",I,[t[8]||(t[8]=(0,s.Lk)("h2",null,"過去7日銷售排行",-1)),(0,s.Lk)("div",_,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(D.sevenDaySalesRanking,((a,o)=>((0,s.uX)(),(0,s.CE)("div",{key:o,class:"product-item"},[(0,s.Lk)("img",{src:e.$getImageUrl(a.image,"product"),class:"product-thumbnail",onError:t[2]||(t[2]=(...t)=>e.handleImageError&&e.handleImageError(...t))},null,40,P),(0,s.Lk)("div",null,(0,r.v_)(o+1)+"."+(0,r.v_)(a.name),1),(0,s.Lk)("div",null,"賣出 "+(0,r.v_)(a.quantity_sold)+"件",1)])))),128))])])):(0,s.Q3)("",!0),D.monthSalesRanking&&D.monthSalesRanking.length>0?((0,s.uX)(),(0,s.CE)("div",A,[t[9]||(t[9]=(0,s.Lk)("h2",null,"過去30日銷售排行",-1)),(0,s.Lk)("div",E,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(D.monthSalesRanking,((a,o)=>((0,s.uX)(),(0,s.CE)("div",{key:o,class:"product-item"},[(0,s.Lk)("img",{src:e.$getImageUrl(a.image,"product"),class:"product-thumbnail",onError:t[3]||(t[3]=(...t)=>e.handleImageError&&e.handleImageError(...t))},null,40,F),(0,s.Lk)("div",null,(0,r.v_)(o+1)+"."+(0,r.v_)(a.name),1),(0,s.Lk)("div",null,"賣出"+(0,r.v_)(a.quantity_sold)+"件",1)])))),128))])])):(0,s.Q3)("",!0),N.processedSpecialOffers.length>0?((0,s.uX)(),(0,s.CE)("div",S,[t[10]||(t[10]=(0,s.Lk)("h2",null,"特價倒數計時商品",-1)),(0,s.Lk)("div",O,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(N.processedSpecialOffers,((a,o)=>((0,s.uX)(),(0,s.CE)("div",{key:o,class:"product-item"},[(0,s.Lk)("img",{src:e.$getImageUrl(a.image,"product"),class:"product-thumbnail",onError:t[4]||(t[4]=(...t)=>e.handleImageError&&e.handleImageError(...t))},null,40,x),(0,s.Lk)("div",null,(0,r.v_)(a.name),1),(0,s.Lk)("div",null,"特價 "+(0,r.v_)(a.price)+"元",1),(0,s.Lk)("div",T," 倒數"+(0,r.v_)(N.formatTime(a.countdown)),1)])))),128))])])):(0,s.Q3)("",!0)],64)}a(4114),a(8992),a(4520),a(2577),a(3949),a(1454);var D=a(4300),N=a(3664);const R={carouselImages:[{url:"/static/img/welcome.jpg"},{url:"/static/img/welcome.jpg"}]};var $={name:"HomePage",beforeUnmount(){this.clearCountdownIntervals()},data(){return{isPageLoading:!0,sevenDaySalesRanking:[],monthSalesRanking:[],specialOffers:[],carouselImages:[],products:[],countdownIntervals:[],isLoading:{sales:!1,offers:!1,carousel:!1,products:!1},errors:{sales:null,offers:null,carousel:null,products:null},randomProducts:null}},async mounted(){console.log("環境變數:",{API_BASE_URL:"https://ecshop-backend.onrender.com/api",CAROUSEL_IMAGE_URL:"https://ecshop-backend.onrender.com/api/img/carouselImages",PRODUCT_IMAGE_URL:"https://ecshop-backend.onrender.com/api/img/products"});try{console.log("開始載入首頁資料"),await this.loadHomePageData(),this.carouselImages.length&&this.carouselImages.length>0&&(await this.$nextTick(),this.initializeCarousel()),console.log("輪播圖片狀態:",{images:this.carouselImages,domElement:document.getElementById("mainCarousel")})}catch(e){console.error("讀取首頁資料失敗",e)}},methods:{handleError(e,t){console.error(`Error in ${e}:`,t.message||t),this.errors[e]=`無法加載 ${e} 數據，請稍後再試。`,"carousel"===e&&(this.carouselImages=R.carouselImages)},async loadHomePageData(){try{await this.loadProductsData(),this.randomProducts=this.getRandomProducts(5),await Promise.allSettled([this.loadSalesData(),this.loadOffersData(),this.loadCarouselData()])}catch(e){console.error("讀取主頁資料失敗",e)}},async loadSalesData(){this.isLoading.sales=!0;try{console.log(this.$axios.defaults.baseURL);const[e,t]=await Promise.all([D.A.rankingAPI.getRanking(7),D.A.rankingAPI.getRanking(30)]);this.sevenDaySalesRanking=this.processSalesRanking(e||[]),this.monthSalesRanking=this.processSalesRanking(t||[]),console.log("Processed Seven Day Sales Ranking:",this.sevenDaySalesRanking),console.log("Processed Month Sales Ranking:",this.monthSalesRanking)}catch(e){console.error("加載銷售數據失敗",e),this.errors.sales="無法加載銷售排行數據",this.sevenDaySalesRanking=[],this.monthSalesRanking=[]}finally{this.isLoading.sales=!1}},processSalesRanking(e){return Array.isArray(e)?e.map((e=>{const t=Number(e.product_id),a=this.products.find((e=>e.id===t));return{product_id:t,name:a?a.name:`Product ID: ${t}`,quantity_sold:e.sale_count||0,image:a&&a.image?this.$getImageUrl(a.image,"product"):"/img/wrong.png"}})).filter((e=>e.quantity_sold>0)).slice(0,10):[]},async loadOffersData(){this.isLoading.offers=!0;try{const e=await D.A.specialOffersAPI.getAllSpecialOffers();e&&Array.isArray(e)&&(this.specialOffers=e.map((e=>({...e,countdown:e.countdown||36e3,product_id:Number(e.product_id)}))),console.log("讀取到的特價商品:",this.specialOffers))}catch(e){console.error("加載特價商品失敗",e),this.errors.offers="無法加載特價商品數據",this.specialOffers=[]}finally{this.isLoading.offers=!1}},async loadCarouselData(){try{const e=await D.A.carouselAPI.getAllCarouselImages();console.log("輪播圖原始數據:",e),Array.isArray(e)&&(this.carouselImages=e.filter((e=>e.visible)).map((e=>({...e,url:this.$getImageUrl(e.url,"carousel")}))),console.log("處理後的輪播圖數據:",this.carouselImages))}catch(e){console.error("載入輪播圖失敗:",e),this.handleError("carousel",e)}},async loadProductsData(){this.isLoading.products=!0;try{const e=await D.A.productAPI.getAllProducts();this.products=e||[]}catch(e){console.error("加載商品數據失敗",e),this.errors.products="無法加載商品列表",this.products=[]}finally{this.isLoading.products=!1}},convertToSortedRankingWithProducts(e){return Object.entries(e).map((([e,t])=>{const a=Number(e),s=this.products.find((e=>e.id===a));return{product_id:e,quantity_sold:t,name:s?s.name:"未知商品",image:s?s.image:"/img/wrong.png"}})).sort(((e,t)=>t.quantity_sold-e.quantity_sold)).slice(0,5)},startCountdown(){this.clearCountdownIntervals(),this.specialOffers&&0!==this.specialOffers.length&&this.specialOffers.forEach(((e,t)=>{if(!e.countdown)return;const a=setInterval((()=>{e.countdown>0?this.specialOffers[t]={...e,countdown:e.countdown-1}:clearInterval(a)}),1e3);this.countdownIntervals.push(a)}))},clearCountdownIntervals(){this.countdownIntervals.forEach((e=>clearInterval(e))),this.countdownIntervals=[]},formatTime(e){const t=Math.floor(e/3600),a=Math.floor(e%3600/60),s=e%60;return`${t}時${a}分${s}秒`},getProductImage(e){const t=this.products.find((t=>t.id===Number(e)));return t&&t.image?this.$getImageUrl(t.image,"product"):"/img/wrong.png"},getRandomProducts(e=5){const t=[...this.products];for(let a=t.length-1;a>0;a--){const e=Math.floor(Math.random()*(a+1));[t[a],t[e]]=[t[e],t[a]]}return t.slice(0,e).map((e=>({product_id:e.id,name:e.name,image:this.getProductImage(e.id),quantity_sold:"-"})))},initializeCarousel(){this.$nextTick((()=>{const e=document.getElementById("mainCarousel");e&&new N.FN(e,{interval:5e3,touch:!0,pause:"hover",keyboard:!0})}))},viewDetails(e){this.$router.push(`/product/${e.product_id}`)}},computed:{processedSpecialOffers(){return this.specialOffers&&this.products?[...this.specialOffers].filter((e=>e.countdown>0)).map((e=>{const t=this.products.find((t=>t.id===e.product_id));return{...e,name:t?t.name:"未知商品",image:t?t.image:"/img/wrong.png"}})):[]}}},M=a(1241);const X=(0,M.A)($,[["render",U],["__scopeId","data-v-1e9736fc"]]);var q=X}},t={};function a(s){var r=t[s];if(void 0!==r)return r.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,s,r,o){if(!s){var i=1/0;for(d=0;d<e.length;d++){s=e[d][0],r=e[d][1],o=e[d][2];for(var n=!0,l=0;l<s.length;l++)(!1&o||i>=o)&&Object.keys(a.O).every((function(e){return a.O[e](s[l])}))?s.splice(l--,1):(n=!1,o<i&&(i=o));if(n){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[s,r,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var r,o,i=s[0],n=s[1],l=s[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(r in n)a.o(n,r)&&(a.m[r]=n[r]);if(l)var d=l(a)}for(t&&t(s);c<i.length;c++)o=i[c],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(d)},s=self["webpackChunkeshop_site"]=self["webpackChunkeshop_site"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[504],(function(){return a(6450)}));s=a.O(s)})();